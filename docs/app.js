"use strict";(()=>{var t={907:()=>{yodasws.page("pageBlog").setRoute({title:"Blog",canonicalRoute:"/blog/",template(t,...e){const n=e.join("/").replace(/\/+/g,"/").replace(/^\/|\/$/g,"").split("/").filter(t=>""!=t);return 0===n.length?"pages/blog/index.html":{canonicalRoute:"/blog/"+n.join("/")+"/",template:"pages/blog/"+n.join(".")+".html"}},route:"/blog(/.*)*"}).on("load",()=>{})}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}(()=>{"use strict";function t(t,n,r){e(t,n),n.set(t,r)}function e(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(t,e,n){return t.set(o(t,e),n),n}function i(t,e){return t.get(o(t,e))}function o(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=m(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(s=function(){return!!t})()}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){v(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function p(t,e,n){return e&&y(t.prototype,e),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function v(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function m(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}n(907);var w=function(t){return Number.isFinite(t)&&!Number.isNaN(t)},k=function(t){return"object"==g(t)&&null!==t},x=function(t){return k(t)&&w(t.col)&&w(t.row)},S=function(t){return Array.isArray(t)&&w(t[0])&&w(t[1])},O=function(t,e){return e+t*(1&e)>>1},T=function(t,e){return function(t){return(t%8+8)%8}(t+e)},P=function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,3),n=e[0],r=e[1],i=e[2];return{q:n,r,s:void 0===i?-n-r:i}};function j(t){var e=t.q,n=t.r,r=t.s,i=w(e),o=w(n),a=w(r);if(i&&o&&a)return{q:e,r:n,s:r};if(i&&o)return{q:e,r:n,s:-e-n};if(i&&a)return{q:e,r:-e-r,s:r};if(o&&a)return{q:-n-r,r:n,s:r};throw new TypeError("Can't determine three cube coordinates from less than two coordinates. Received: { q: ".concat(e,", r: ").concat(n,", s: ").concat(r," }."))}var E=function(t){return t.FLAT="FLAT",t.POINTY="POINTY",t}(E||{});var M=function(){return p(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];h(this,t),v(this,"q",void 0),v(this,"r",void 0);var n=D(this,e),r=n.q,i=n.r;this.q=r,this.r=i},[{key:"center",get:function(){var t=this.width,e=this.height;return{x:t/2-this.x,y:e/2-this.y}}},{key:"col",get:function(){return R(this).col}},{key:"corners",get:function(){var t=this.orientation,e=this.width,n=this.height,r=this.x,i=this.y;return t===E.POINTY?A(e,n,r,i):I(e,n,r,i)}},{key:"dimensions",get:function(){return C.dimensions}},{key:"height",get:function(){var t=this.orientation,e=this.dimensions.yRadius;return t===E.POINTY?2*e:e*Math.sqrt(3)}},{key:"isFlat",get:function(){return this.orientation===E.FLAT}},{key:"isPointy",get:function(){return this.orientation===E.POINTY}},{key:"orientation",get:function(){return C.orientation}},{key:"origin",get:function(){return C.origin}},{key:"offset",get:function(){return C.offset}},{key:"row",get:function(){return R(this).row}},{key:"width",get:function(){var t=this.orientation,e=this.dimensions.xRadius;return t===E.POINTY?e*Math.sqrt(3):2*e}},{key:"x",get:function(){return _(this).x}},{key:"y",get:function(){return _(this).y}},{key:"s",get:function(){return-this.q-this.r}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return new this.constructor(t)}},{key:"equals",value:function(t){return function(t,e){if(x(t)&&x(e))return t.col===e.col&&t.row===e.row;if(Object.hasOwn(t,"col")||Object.hasOwn(e,"col"))throw new Error("Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ".concat(JSON.stringify(t)," and ").concat(JSON.stringify(e)));var n=S(t)?P(t):t,r=S(e)?P(e):e;return n.q===r.q&&n.r===r.r}(this,x(t)?N(this,t):t)}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.q,",").concat(this.r,")")}},{key:"translate",value:function(t){return function(t,e){var n=j(t),r=n.q,i=n.r,o=n.s,a=j(e),s={q:r+a.q,r:i+a.r,s:o+a.s};return t instanceof M?t.clone(s):s}(this,t)}}],[{key:"settings",get:function(){var t=this.prototype;return{dimensions:t.dimensions,orientation:t.orientation,origin:t.origin,offset:t.offset}}}])}(),C={dimensions:{xRadius:1,yRadius:1},orientation:E.POINTY,origin:{x:0,y:0},offset:-1},A=function(t,e,n,r){return[{x:n+.5*t,y:r-.25*e},{x:n+.5*t,y:r+.25*e},{x:n,y:r+.5*e},{x:n-.5*t,y:r+.25*e},{x:n-.5*t,y:r-.25*e},{x:n,y:r-.5*e}]},I=function(t,e,n,r){return[{x:n+.25*t,y:r-.5*e},{x:n+.5*t,y:r},{x:n+.25*t,y:r+.5*e},{x:n-.25*t,y:r+.5*e},{x:n-.5*t,y:r},{x:n-.25*t,y:r-.5*e}]};function W(t){var e=f(f({},C),t),n=e.dimensions,r=e.orientation,i=e.origin,o=e.offset;return function(t){function e(){return h(this,e),function(t,e,n){return e=c(e),function(t,e){if(e&&("object"==g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,s()?Reflect.construct(e,n||[],c(t).constructor):e.apply(t,n))}(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(e,t),p(e,[{key:"dimensions",get:function(){return function(t,e){if(k(t)&&t.xRadius>0&&t.yRadius>0)return t;if(k(t)&&t.width>0&&t.height>0){var n=t.width,r=t.height;return e===E.POINTY?{xRadius:n/Math.sqrt(3),yRadius:r/2}:{xRadius:n/2,yRadius:r/Math.sqrt(3)}}if(t>0)return{xRadius:t,yRadius:t};throw new TypeError("Invalid dimensions: ".concat(JSON.stringify(t),". Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number."))}(n,r)}},{key:"orientation",get:function(){return r}},{key:"origin",get:function(){return function(t,e){if(function(t){return k(t)&&w(t.x)&&w(t.y)}(t))return t;if(!e)throw new TypeError("Supply a bounding box ({ width: number, height: number }). Received: ".concat(JSON.stringify(e)));if("topLeft"===t)return{x:-.5*e.width,y:-.5*e.height};throw new TypeError("Invalid origin: ".concat(JSON.stringify(t),". Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'."))}(i,this)}},{key:"offset",get:function(){return o}}])}(M)}var R=function(t){var e=t.q,n=t.r,r=t.offset;return t.isPointy?function(t,e,n){return{col:t+O(n,e),row:e}}(e,n,r):function(t,e,n){return{col:t,row:e+O(n,t)}}(e,n,r)},_=function(t){var e=t.orientation,n=t.dimensions,r=n.xRadius,i=n.yRadius,o=t.origin,a=o.x,s=o.y,c=t.q,u=t.r;return e===E.POINTY?{x:r*Math.sqrt(3)*(c+u/2)-a,y:3*i/2*u-s}:{x:3*r/2*c-a,y:i*Math.sqrt(3)*(u+c/2)-s}},q=function(t,e,n){var r=t-O(n,e);return{q:r,r:e,s:-r-e}},L=function(t,e,n){var r=t,i=e-O(n,t);return{q:r,r:i,s:-r-i}},N=function(t,e){var n=t.offset,r=t.orientation,i=e.col,o=e.row;return r===E.POINTY?q(i,o,n):L(i,o,n)},F=function(t){var e=j(t),n=e.q,r=e.r,i=e.s,o=Math.round(n),a=Math.round(r),s=Math.round(i),c=Math.abs(n-o),u=Math.abs(r-a),l=Math.abs(i-s);return c>u&&c>l?o=-a-s:u>l?a=-o-s:s=-o-a,{q:o,r:a,s}};function D(t,e){return S(e)?P(e):x(e)?N(t,e):j(e)}function U(t,e,n){var r=D(t,e),i=r.q,o=r.r,a=r.s,s=D(t,n),c=s.q,u=s.r,l=s.s;return Math.max(Math.abs(i-c),Math.abs(o-u),Math.abs(a-l))}var H=function(t){return t.CLOCKWISE="CLOCKWISE",t.COUNTERCLOCKWISE="COUNTERCLOCKWISE",t}(H||{}),G=function(t){return t[t.N=0]="N",t[t.NE=1]="NE",t[t.E=2]="E",t[t.SE=3]="SE",t[t.S=4]="S",t[t.SW=5]="SW",t[t.W=6]="W",t[t.NW=7]="NW",t}(G||{}),V=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],B=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],z=function(t,e){return t.clone(t.isPointy?function(t,e){var n=t.offset,r=t.q,i=t.r,o=t.col,a=t.row;if(e===G.S||e===G.N){var s=e===G.S?a+1:a-1;return q(o,s,n)}var c=V[e];return{q:r+c.q,r:i+c.r}}(t,e):function(t,e){var n=t.offset,r=t.q,i=t.r,o=t.col,a=t.row;if(e===G.E||e===G.W){var s=e===G.E?o+1:o-1;return L(s,a,n)}var c=B[e];return{q:r+c.q,r:i+c.r}}(t,e))};function K(t){return Array.isArray(t)?function(e,n){var r,i=[],o=n,s=a(t);try{for(s.s();!(r=s.n()).done;){var c,u=a((0,r.value)(e,o));try{for(u.s();!(c=u.n()).done;){var l=c.value;i.push(o=l)}}catch(t){u.e(t)}finally{u.f()}}}catch(t){s.e(t)}finally{s.f()}return i}:t}function Y(t){return function(t){return t.direction in G}(t)?function(t){var e=t.start,n=t.direction,r=t.length;return function(t,i){var o=[],a=t(null!=e?e:i);!e&&i&&(a=z(a,n));for(var s=0;s<r;s++)o.push(a),a=z(a,n);return o}}(t):function(t){var e=t.start,n=t.stop;return function(t,r){for(var i=[],o=t(null!=e?e:r),a=function(t,e){return function(n){return{q:t.q*(1-n)+e.q*n,r:t.r*(1-n)+e.r*n}}}(J(o),J(D(o,n))),s=U(o,o,n),c=1/Math.max(s,1),u=!e&&r?1:0;u<=s;u++){var l=F(a(c*u));i.push(t(l))}return i}}(t)}function J(t){return{q:t.q+1e-6,r:t.r+1e-6,s:t.s+-2e-6}}function X(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).includeSource,r=void 0===n||n;return function(n,i){var o,s=[],c=a(K(t)(n,i));try{for(c.s();!(o=c.n()).done;){var u=o.value;r&&s.push(u);var l,f=a(K(e)(n,u));try{for(f.s();!(l=f.n()).done;){var h=l.value;s.push(h)}}catch(t){f.e(t)}finally{f.f()}}}catch(t){c.e(t)}finally{c.f()}return s}}function $(t,e){return function(n,r){var i,o=e?function(t,e,n){var r=n.isPointy,i=n.offset,o=Q(t,r,i),a=o.col,s=o.row,c=Q(e,r,i),u=c.col,l=c.row,f=Z[(a<u?"A":"B")+(s<l?"A":"B")],h=f.swapWidthHeight,y=f.direction,p=Math.abs(a-u)+1,v=Math.abs(s-l)+1;return{width:h?v:p,height:h?p:v,start:t,direction:y}}(t,e,n()):t,a=o.width,s=o.height,c=o.start,u=o.direction,l=void 0===u?G.E:u,f=null!==(i=null!=c?c:r)&&void 0!==i?i:[0,0],h=X(Y({start:f,direction:T(l,2),length:s}),Y({direction:l,length:a-1}))(n,f);return!c&&r?h.slice(1):h}}function Q(t,e,n){if(x(t))return t;var r=S(t)?P(t):j(t),i=r.q,o=r.r;return R({q:i,r:o,isPointy:e,offset:n})}var Z={AA:{swapWidthHeight:!1,direction:G.E},AB:{swapWidthHeight:!0,direction:G.N},BA:{swapWidthHeight:!0,direction:G.S},BB:{swapWidthHeight:!1,direction:G.W}};function tt(t){var e=t.center,n=t.rotation,r=void 0===n?H.CLOCKWISE:n;return function(n,i){var o,a,s=r.toUpperCase(),c=[],u=t.radius,l=w(u);l?a=n(e).translate({q:u,s:-u}):u=U(a=n(null!==(o=t.start)&&void 0!==o?o:i),e,a);var f=D(a,e),h=n({q:f.q,r:f.r-u,s:f.s+u});if(s===H.CLOCKWISE)for(var y=0;y<6;y++)for(var p=0;p<u;p++){var v=et[y],d=v.q,m=v.r;h=n({q:h.q+d,r:h.r+m}),c.push(h)}else for(var b=5;b>=0;b--)for(var g=0;g<u;g++){var k=et[b],x=k.q,S=k.r;h=n({q:h.q-x,r:h.r-S}),c.push(h)}var O=!l&&!t.start&&i,T=c.findIndex(function(t){return t.equals(a)});return c.slice(T+(O?1:0)).concat(c.slice(0,T))}}var et=[{q:1,r:0},{q:0,r:1},{q:-1,r:1},{q:-1,r:0},{q:0,r:-1},{q:1,r:-1}];function nt(t){var e=t.radius,n=t.start,r=t.rotation;return function(t,i){var o,a=null!==(o=null!=n?n:i)&&void 0!==o?o:[0,0],s=!n&&i?e:e+1;return X(Y({start:n,direction:G.N,length:s}),tt({center:a,rotation:r}))(t,i)}}var rt=new WeakMap,it=new WeakMap,ot=new WeakSet,at=function(){function n(a){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(h(this,n),function(t,n){e(t,n),n.add(t)}(this,ot),t(this,rt,void 0),t(this,it,new Map),a instanceof n)return r(rt,this,i(rt,a)),void this.setHexes(a);r(rt,this,a),this.setHexes(o(ot,this,ct).call(this,s))}return p(n,[{key:"size",get:function(){return i(it,this).size}},{key:"pixelWidth",get:function(){if(0===this.size)return 0;var t=this.hexPrototype,e=t.isPointy,n=t.width,r=this.toArray(),i=e?r.sort(function(t,e){return e.s-t.s||t.q-e.q}):r.sort(function(t,e){return t.q-e.q}),o=i[0];return i[i.length-1].x-o.x+n}},{key:"pixelHeight",get:function(){if(0===this.size)return 0;var t=this.hexPrototype,e=t.isPointy,n=t.height,r=this.toArray(),i=e?r.sort(function(t,e){return t.r-e.r}):r.sort(function(t,e){return e.s-t.s||t.r-e.r}),o=i[0];return i[i.length-1].y-o.y+n}},{key:Symbol.iterator,value:function(){return i(it,this).values()}},{key:"hexPrototype",get:function(){return i(rt,this).prototype}},{key:"createHex",value:function(t){return new(i(rt,this))(t)}},{key:"getHex",value:function(t){var e=this.createHex(t);return i(it,this).get(e.toString())}},{key:"hasHex",value:function(t){return i(it,this).has(t.toString())}},{key:"setHexes",value:function(t){var e,n=a(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,s=r instanceof M?r:new(i(rt,this))(r);o(ot,this,st).call(this,s)}}catch(t){n.e(t)}finally{n.f()}return this}},{key:"filter",value:function(t){var e,r=new n(i(rt,this)),s=a(this);try{for(s.s();!(e=s.n()).done;){var c=e.value;t(c)&&o(ot,r,st).call(r,c)}}catch(t){s.e(t)}finally{s.f()}return r}},{key:"map",value:function(t){var e,r=new n(i(rt,this)),s=a(this);try{for(s.s();!(e=s.n()).done;){var c=e.value;o(ot,r,st).call(r,t(c))}}catch(t){s.e(t)}finally{s.f()}return r}},{key:"traverse",value:function(t){var e,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bail,s=void 0!==r&&r,c=new n(i(rt,this)),u=a(o(ot,this,ct).call(this,t));try{for(u.s();!(e=u.n()).done;){var l=e.value,f=this.getHex(l);if(f)o(ot,c,st).call(c,f);else if(s)return c}}catch(t){u.e(t)}finally{u.f()}return c}},{key:"forEach",value:function(t){var e,n=a(this);try{for(n.s();!(e=n.n()).done;)t(e.value)}catch(t){n.e(t)}finally{n.f()}return this}},{key:"reduce",value:function(t,e){if(void 0===e){var n,r,i,o,s=a(this);try{for(s.s();!(o=s.n()).done;){var c=o.value;r=i,i=c,r&&(n=t(r,i))}}catch(t){s.e(t)}finally{s.f()}return n}var u,l=e,f=a(this);try{for(f.s();!(u=f.n()).done;)l=t(l,u.value)}catch(t){f.e(t)}finally{f.f()}return l}},{key:"toArray",value:function(){return Array.from(this)}},{key:"toJSON",value:function(){var t=this.hexPrototype;return{hexSettings:{dimensions:t.dimensions,orientation:t.orientation,origin:t.origin,offset:t.offset},coordinates:this.toArray()}}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.size,")")}},{key:"pointToHex",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allowOutside,n=void 0===e||e,r=function(t,e){var n=t.dimensions,r=n.xRadius,i=n.yRadius,o=t.origin,a=t.orientation,s=e.x,c=e.y;return s+=o.x,c+=o.y,a===E.POINTY?F({q:Math.sqrt(3)*s/(3*r)-c/(3*i),r:2/3*(c/i)}):F({q:2/3*(s/r),r:Math.sqrt(3)*c/(3*i)-s/(3*r)})}(this.hexPrototype,t),i=this.getHex(r);return n?null!=i?i:this.createHex(r):i}},{key:"distance",value:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside;if(void 0===n||n)return U(this.hexPrototype,t,e);var r=this.getHex(t),i=this.getHex(e);return r&&i?U(this.hexPrototype,r,i):void 0}},{key:"neighborOf",value:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside,r=void 0===n||n,i=z(this.createHex(t),e),o=this.getHex(i);return r?null!=o?o:i:o}}],[{key:"fromIterable",value:function(t){var e=t[Symbol.iterator]().next().value;if(!e)throw new TypeError("Can't create grid from empty iterable: ".concat(JSON.stringify(t)));return new n(e.constructor,t)}},{key:"fromJSON",value:function(t,e){var r=t.hexSettings,i=t.coordinates;if(e){var o=i.map(e);return new n(o.length>0?o[0].constructor:e({q:0,r:0},0,[{q:0,r:0}]).constructor,o)}var a=W(r);return new n(a,i.map(function(t){return new a(t)}))}}])}();function st(t){i(it,this).set(t.toString(),t)}function ct(t){return o(ot,this,ut).call(this,t)?o(ot,this,lt).call(this,t):Array.isArray(t)&&o(ot,this,ut).call(this,t[0])?o(ot,this,lt).call(this,K(t)):t}function ut(t){return"function"==typeof t}function lt(t){return t(this.createHex.bind(this))}var ft=200;void 0===globalThis.window&&(globalThis.window={visualViewport:{height:1080,width:1920}});var ht=function(){return{height:window.visualViewport.height/.5,width:window.visualViewport.width/.5,offscreen:-2*Math.max(window.visualViewport.width,window.visualViewport.height)}},yt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,r=(t.y-e.y)/(t.x-e.x),i=t.y-r*t.x,o=(t.x-e.x)*n+e.x;return{x:o,y:r*o+i}};const pt=JSON.parse("{\"actions\":[{\"key\":\"move\",\"label\":\"Move here\",\"description\":\"Move to target location\",\"icon\":\"move-to-tile.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isLegalMove\",\"execute\":\"startMoveTo\"},{\"key\":\"wait\",\"label\":\"Wait\",\"description\":\"Wait and come back later this turn\",\"icon\":\"wait.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"wait\"},{\"key\":\"skip\",\"label\":\"Skip\",\"description\":\"Skip this unit's turn\",\"icon\":\"skip.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"skip\"},{\"key\":\"tile\",\"label\":\"Information on space\",\"description\":\"View information about this tile\",\"icon\":\"about-tile.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"hexTileValid\",\"execute\":\"startTileView\"},{\"key\":\"city-view\",\"label\":\"View City\",\"description\":\"View information about this city\",\"icon\":\"city-view.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isCityTile\",\"execute\":\"startCityView\"},{\"key\":\"build-farm\",\"label\":\"Build Farm\",\"description\":\"Construct a farm on this tile. The farmer unit will be consumed and become a laborer to work the farm.\",\"icon\":\"farm.png\",\"unitTypes\":[\"farmer\"],\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"isFarmBuildable\",\"execute\":\"buildFarm\"},{\"key\":\"end-turn\",\"label\":\"End Turn\",\"description\":\"End Turn\",\"icon\":\"end-turn.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"currentPlayerTurn\",\"execute\":\"endTurn\"}],\"improvements\":{\"farm\":{\"title\":\"Subsistence Farm\",\"tile\":\"farm\",\"housing\":1,\"terrains\":{\"grass\":{\"food\":2,\"turnsForProduction\":1},\"moor\":{\"food\":1,\"turnsForProduction\":1},\"swamp\":{\"food\":2,\"turnsForProduction\":6}}}},\"FactionNames\":[\"Publius Helvius Pertinax\",\"Gaius Flavius Agricola\",\"Brigantes\",\"Catuvellauni\",\"Trinovantes\",\"Dobunni\",\"Cornovii\",\"Atrebates\"],\"NationNames\":[\"Roman Empire\"],\"StandardMovable\":{\"crossCreeks\":1.25,\"crossStreams\":1.5,\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"canal\":12,\"stream\":12,\"river\":24,\"desert\":12,\"grass\":12,\"hill\":18,\"marsh\":18,\"moor\":12,\"mountain\":24,\"oceans\":12,\"swamp\":24}},\"ResourceValues\":{\"food\":10},\"ResourceTransporter\":{\"crossCreeks\":1.25,\"crossStreams\":2,\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"canal\":3,\"stream\":6,\"river\":3,\"desert\":12,\"grass\":12,\"hill\":18,\"marsh\":18,\"moor\":12,\"mountain\":24,\"oceans\":12,\"swamp\":24}},\"goods\":{\"food\":{\"tile\":\"wheat\"}},\"terrains\":{\"desert\":{\"name\":\"Desert\",\"movementCost\":12,\"food\":0,\"tile\":\"desert\"},\"grass\":{\"name\":\"Grassland\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"hill\":{\"name\":\"Hill\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"lake\":{\"name\":\"Lake\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"lake\"},\"marsh\":{\"name\":\"Marsh\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"},\"moor\":{\"name\":\"Moor\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"mountain\":{\"name\":\"Mountain\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"ocean\":{\"name\":\"Ocean\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"ocean\"},\"swamp\":{\"name\":\"Swamp\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"}},\"laborers\":{\"farmer\":{\"name\":\"Farmer\"},\"miner\":{\"name\":\"Miner\"},\"rancher\":{\"name\":\"Rancher\"}},\"units\":{\"builder\":{\"name\":\"Builder\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"farmer\":{\"name\":\"Farmer\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"miner\":{\"name\":\"Miner\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"rancher\":{\"name\":\"Rancher\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"settler\":{\"name\":\"Settler\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"warrior\":{\"name\":\"Warrior\",\"attack\":1,\"attackCities\":true,\"defense\":1,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}}},\"world\":[[{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"swamp\",\"river\":true},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"desert\"},{\"terrain\":\"desert\",\"river\":true},{\"terrain\":\"desert\"},{\"terrain\":\"grass\",\"city\":{\"nation\":0}},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}]]}");function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function dt(){dt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:P(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",y="suspendedYield",p="executing",v="completed",d={};function m(){}function b(){}function g(){}var w={};u(w,a,function(){return this});var k=Object.getPrototypeOf,x=k&&k(k(A([])));x&&x!==n&&r.call(x,a)&&(w=x);var S=g.prototype=m.prototype=Object.create(w);function O(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function T(t,e){function n(i,o,a,s){var c=f(t[i],t,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==vt(l)&&r.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){u.value=t,a(u)},function(t){return n("throw",t,a,s)})}s(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e(function(e,i){n(t,r,e,i)})}return o=o?o.then(i,i):i()}})}function P(e,n,r){var i=h;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=j(s,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?v:y,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=v,r.method="throw",r.arg=u.arg)}}}function j(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,j(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,d;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(vt(e)+" is not iterable")}return b.prototype=g,i(S,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=u(g,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,c,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},O(T.prototype),u(T.prototype,s,function(){return this}),e.AsyncIterator=T,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new T(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},O(S),u(S,c,"Generator"),u(S,a,function(){return this}),u(S,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),M(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}var mt=dt().mark(Nt);function bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(n),!0).forEach(function(e){wt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function wt(t,e,n){return(e=xt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xt(r.key),r)}}function xt(t){var e=function(t){if("object"!=vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}function St(t,e,n){Ot(t,e),e.set(t,n)}function Ot(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Tt(t,e){return t.get(jt(t,e))}function Pt(t,e,n){return t.set(jt(t,e),n),n}function jt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function Et(t,e,n,r){if(!dr(t))throw new TypeError("FindPath expects a Hex as start!");if(!dr(e))throw new TypeError("FindPath expects a Hex as end!");if(!Lt.isInstanceofMovable(n))throw new TypeError("FindPath expects a Movable!");var i=[],o=[],a=!1;t.parent=void 0,i.push(t),t.g_cost=0;for(var s=function(){var t=i.sort(function(t,e){return t.f_cost-e.f_cost||t.h_cost-e.h_cost})[0];if(t===e)return a=!0,1;i=i.filter(function(e){return t!==e}),o.push(t),r.traverse(tt({center:[t.q,t.r],radius:1})).forEach(function(a){o.includes(a)||br(a,n)&&(a.g_cost=t.g_cost+gr(n,a,t),a.h_cost=r.distance(t,e),a.f_cost=a.g_cost+a.h_cost,i.includes(a)||(a.parent=t,i.push(a)))})};i.length>0&&!s(););if(!a)return[];var c=[e],u=e;do{var l;(u=u.parent)!==t&&c.unshift(u)}while(dr(null===(l=u)||void 0===l?void 0:l.parent));return c}var Mt=new WeakMap,Ct=new WeakMap,At=new WeakMap,It=new WeakMap,Wt=new WeakMap,Rt=new WeakMap,_t=new WeakMap,qt=new WeakSet,Lt=function(){function t(e){var n=e.base,r=void 0===n?{}:n,i=e.hex,o=e.faction;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Ot(t,e),e.add(t)}(this,qt),St(this,Mt,pt.StandardMovable),St(this,Ct,!1),St(this,At,void 0),St(this,It,void 0),St(this,Wt,null),St(this,Rt,0),St(this,_t,[]),!dr(i))throw new TypeError("Movable expects to be assigned a Hex!");Pt(At,this,Qe.isFaction(o)?o:i.tile.faction),Pt(It,this,i),Pt(Mt,this,gt(gt(gt({},Tt(Mt,this)),r),{},{movementCosts:gt(gt({},Tt(Mt,this).movementCosts),r.movementCosts)}))}return e=t,n=[{key:"baseMovementPoints",get:function(){return Tt(Mt,this).movementPoints}},{key:"deleted",get:function(){return Tt(Ct,this)},set:function(t){Pt(Ct,this,!!t)}},{key:"faction",get:function(){return Tt(At,this)}},{key:"canContinueOnPath",get:function(){return null!==Tt(Wt,this)&&Tt(_t,this).length>0&&Tt(Rt,this)>0}},{key:"hex",get:function(){return Tt(It,this)}},{key:"movementCosts",get:function(){return Tt(Mt,this).movementCosts}},{key:"moveOnWater",get:function(){return Tt(Mt,this).moveOnWater||!1}},{key:"moves",get:function(){return Tt(Rt,this)}},{key:"row",get:function(){return Tt(It,this).row}},{key:"col",get:function(){return Tt(It,this).col}},{key:"activate",value:function(){!0===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.canContinueOnPath?this.moveOneTurn():Pt(Wt,this,null)}},{key:"deactivate",value:function(){!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Pt(Rt,this,0)}},{key:"destroy",value:function(){Pt(Rt,this,0),Pt(_t,this,[]),this.deleted=!0,Pt(Wt,this,null)}},{key:"prepareForNewTurn",value:function(){Pt(Rt,this,Tt(Mt,this).movementPoints)}},{key:"setPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;if(!dr(t))throw new TypeError("Movable.setPath expects to be assigned a Hex!");var n=Et(Tt(It,this),t,this,e);return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;if(!Array.isArray(t)||0===t.length||t.some(function(t){return!dr(t)}))return!1;for(var n=1;n<t.length;n++){var r=t[n-1],i=t[n];if(1!==e.distance(r,i))return!1}return!0}(n,e)?(Pt(_t,this,n),Pt(Wt,this,jt(qt,this,Nt).call(this))):(console.warn("Sam, no path found!"),Pt(Wt,this,null))}},{key:"moveOneStep",value:function(){if(null!==Tt(Wt,this)){var t=Tt(Wt,this).next();Pt(It,this,t.value),(t.done||Tt(_t,this).length<=0)&&Pt(Wt,this,null)}}},{key:"moveOneTurn",value:function(){for(;this.canContinueOnPath;)this.moveOneStep()}}],r=[{key:"isInstanceofMovable",value:function(e){return e instanceof t}},{key:"isActivatableMovable",value:function(e){return t.isInstanceofMovable(e)&&!1===e.deleted}},{key:"isMovableCanMove",value:function(e){return t.isActivatableMovable(e)&&e.moves>0}}],n&&kt(e.prototype,n),r&&kt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Nt(){var t,e;return dt().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(Tt(_t,this).length>0)){n.next=12;break}if(t=Tt(_t,this)[0],e=gr(this,t),!(Tt(Rt,this)<e)){n.next=6;break}return this.deactivate(!0),n.abrupt("break",12);case 6:return Pt(Rt,this,Tt(Rt,this)-e),Pt(It,this,t),n.next=10,Tt(_t,this).shift();case 10:n.next=0;break;case 12:case"end":return n.stop()}},mt,this)}function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ut(r.key),r)}}function Ut(t){var e=function(t){if("object"!=Ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ft(e)?e:e+""}function Ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ht=function(){return!!t})()}function Gt(t){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gt(t)}function Vt(t,e){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vt(t,e)}function Bt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function zt(t,e){return t.get(Yt(t,e))}function Kt(t,e,n){return t.set(Yt(t,e),n),n}function Yt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Jt=new WeakMap,Xt=new WeakMap,$t=new WeakMap,Qt=new WeakMap,Zt=function(t){function e(t,n){var r,i=n.hex,o=n.num,a=void 0===o?1:o;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!e.isValidGoodsType(t))throw new TypeError("Unknown Goods type '".concat(t,"'"));return Bt(r=function(t,e,n){return e=Gt(e),function(t,e){if(e&&("object"==Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ht()?Reflect.construct(e,n||[],Gt(t).constructor):e.apply(t,n))}(this,e,[{base:pt.ResourceTransporter,hex:i}]),Jt,void 0),Bt(r,Xt,void 0),Bt(r,$t,0),Bt(r,Qt,void 0),Kt(Jt,r,t),Kt(Xt,r,a),Kt(Qt,r,i),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vt(t,e)}(e,t),n=e,i=[{key:"isGoods",value:function(t){return t instanceof e}},{key:"isValidGoodsType",value:function(t){var e;return"object"===Ft(null!==(e=pt.goods[t])&&void 0!==e&&e)}}],(r=[{key:"goodsType",get:function(){return zt(Jt,this)}},{key:"num",get:function(){return zt(Xt,this)},set:function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("Goods.num expects to be assigned a nonnegative integer!");Kt(Xt,this,t)}},{key:"rounds",get:function(){return zt($t,this)},set:function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("Goods.rounds expects to be assigned a nonnegative integer!");Kt($t,this,t)}},{key:"start",get:function(){return zt(Qt,this)}}])&&Dt(n.prototype,r),i&&Dt(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(Lt);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,re(r.key),r)}}function re(t){var e=function(t){if("object"!=te(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:e+""}function ie(t){var e="function"==typeof Map?new Map:void 0;return ie=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(oe())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&ae(i,n.prototype),i}(t,arguments,se(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ae(n,t)},ie(t)}function oe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(oe=function(){return!!t})()}function ae(t,e){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ae(t,e)}function se(t){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},se(t)}var ce=[],ue=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,n){return e=se(e),function(t,e){if(e&&("object"==te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,oe()?Reflect.construct(e,n||[],se(t).constructor):e.apply(t,n))}(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}(e,t),n=e,r=[{key:"on",value:function(t,e){this.addEventListener(t,e)}},{key:"off",value:function(t,e){this.removeEventListener(t,e)}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.dispatchEvent(new CustomEvent(t,{detail:e}))}}],r&&ne(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ie(EventTarget)),le={events:new ue,players:[],turn:0,activeUnit:null,currentPlayer:null,intCurrentPlayer:null,graphics:{},startRound:function(){var t=this;this.players.forEach(function(t){t.units=t.units}),mr.forEach(function(e){if(t.nations.forEach(function(t){e.tile.nation===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),t.players.forEach(function(t){e.tile.faction===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),e.tile.food=0,e.tile.laborers.size>0){var n=0;if(n+=e.terrain.food||0,(n+=e.tile.improvement.food||0)>0){var r=new Zt("food",{num:n,hex:e});ce.push(r),t.events.emit("goods-created",{goods:r})}}}),mr.forEach(function(t){sr.isCity(t.city)&&(t.city,mr.traverse(nt({start:[t.q,t.r],radius:2})).forEach(function(t){}))}),this.turn++,this.startTurn(0)},startTurn:function(t){if(!Number.isFinite(t))throw new TypeError("Unknown player ".concat(t));if(this.currentPlayer=this.players[t],!(this.currentPlayer instanceof Qe))throw new TypeError("Player ".concat(t," is not a Faction Object"));this.intCurrentPlayer=t,this.currentPlayer.units.forEach(function(t){t.prepareForNewTurn()}),this.currentPlayer.activateUnit(0)},markTerritory:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.graphics,r=void 0===n?this.graphics.territoryLines:n,i=e.lineOffset,o=void 0===i?.97:i,a=e.offsetX,s=void 0===a?0:a,c=e.offsetY,u=void 0===c?0:c,l=e.fill,f=void 0!==l&&l,h=e.lineWidth,y=void 0===h?5:h;(dr(t)?[t]:mr).forEach(function(t){if(Cn.isTile(t.tile)&&t.tile.faction instanceof Qe){!1===f?r.lineStyle(y,t.tile.faction.color):r.fillStyle(t.tile.faction.color),r.beginPath();var e=function(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ee(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.corners.map(function(e){return yt(e,t,o)})),n=e[0],i=e.slice(1);r.moveTo(n.x+s,n.y+u),i.forEach(function(t){var e=t.x,n=t.y;r.lineTo(e+s,n+u)}),r.closePath()[!1===f?"strokePath":"fillPath"]()}})},endTurn:function(){this.intCurrentPlayer++,this.intCurrentPlayer>=this.players.length?this.endRound():this.startTurn(this.intCurrentPlayer)},endRound:function(){var t=this;this.betweenRounds=!0;var e=[];mr.forEach(function(t){sr.isCity(t.city)&&e.push(t)}),ce.forEach(function(t,n){t.faction;var r=t.hex,i=t.num,o=t.goodsType;if("food"===o)if(i<=0)t.destroy();else{if(r.tile.laborers.size>0&&r.tile.food<r.tile.laborers.size*Bn.FOOD_CONSUMPTION){var a=Math.max(0,r.tile.laborers.size*Bn.FOOD_CONSUMPTION-r.tile.food),s=Math.min(a,i);if(t.num=i-=s,r.tile.food+=s,i<=0)return void t.destroy()}var c=null,u=1/0;e.forEach(function(t){var e=mr.distance(r,t);e<u&&(c=t,u=e)}),dr(c)&&sr.isCity(c.city)&&null!==t.setPath(c)&&(t.prepareForNewTurn(),t.moveOneTurn()),"food"===o&&++t.rounds>5&&t.destroy()}}),mr.forEach(function(t){t.tile.laborers.size>0&&(t.tile.food,t.tile.laborers.size,Bn.FOOD_CONSUMPTION),t.tile.food-=t.tile.laborers.size*Bn.FOOD_CONSUMPTION}),Promise.all([]).then(function(){t.betweenRounds=!1,t.startRound()})}};function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function he(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ye(r.key),r)}}function ye(t){var e=function(t){if("object"!=fe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fe(e)?e:e+""}function pe(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function ve(t,e){return t.get(me(t,e))}function de(t,e,n){return t.set(me(t,e),n),n}function me(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}le.events.on("end-turn",le.endTurn.bind(le));var be=new Map,ge=new WeakMap,we=new WeakMap,ke=new WeakMap,xe=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),pe(this,ge,void 0),pe(this,we,void 0),pe(this,ke,void 0),de(ge,this,{x:e.hex.x,y:e.hex.y}),de(we,this,n),de(ke,this,n.add.sprite(ve(ge,this).x,ve(ge,this).y,"unit.".concat(e.unitType)).setTint(3684408).setDepth(11)),ve(ke,this).setScale(80/ve(ke,this).width)},(e=[{key:"scene",get:function(){return ve(we,this)}},{key:"sprite",get:function(){return ve(ke,this)}},{key:"x",get:function(){return ve(ge,this).x}},{key:"y",get:function(){return ve(ge,this).y}},{key:"update",value:function(t){ve(ge,this).x=t.x,ve(ge,this).y=t.y}}])&&he(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Se(t){if(be.has(t)){var e=be.get(t);e.sprite.setVisible(!1),e.sprite.destroy(),be.delete(t)}}function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function Te(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Pe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,je(r.key),r)}}function je(t){var e=function(t){if("object"!=Oe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Oe(e)?e:e+""}function Ee(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ee=function(){return!!t})()}function Me(t,e,n,r){var i=Ce(Ae(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof i?function(t){return i.apply(n,t)}:i}function Ce(){return Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ae(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Ce.apply(null,arguments)}function Ae(t){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ae(t)}function Ie(t,e){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ie(t,e)}function We(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function Re(t,e,n){switch(t){case"u":n%2==0&&e--,n--;break;case"i":e--;break;case"o":n%2==0&&e--,n++;break;case"j":n%2==1&&e++,n--;break;case"k":e++;break;case"l":n%2==1&&e++,n++;break;default:throw new TypeError("Unknown action tile '".concat(t,"'"))}return[e,n]}var _e=new WeakMap,qe=function(t){function e(t,n){var r,i,o=n.hex,a=n.faction;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!Qe.isFaction(a))throw new TypeError("Unit expects to be assigned a Faction!");return function(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}(i=function(t,e,n){return e=Ae(e),function(t,e){if(e&&("object"==Oe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ee()?Reflect.construct(e,n||[],Ae(t).constructor):e.apply(t,n))}(this,e,[{base:null!==(r=pt.units[t])&&void 0!==r?r:function(t){throw new TypeError(t)}("Unknown unit '".concat(t,"'")),hex:o,faction:a}]),_e,void 0),function(t,e,n){t.set(We(t,e),n)}(_e,i,t),le.events.emit("unit-created",{unit:i}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ie(t,e)}(e,t),n=e,r=[{key:"unitType",get:function(){return function(t,e){return t.get(We(t,e))}(_e,this)}},{key:"deactivate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Me(e,"deactivate",this,3)([t]),le.activeUnit=null,le.events.emit("unit-deactivated",{unit:this}),this.faction.checkEndTurn()}},{key:"activate",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Me(e,"activate",this,3)([t]),le.activeUnit=this,0===this.faction.index?le.events.emit("unit-activated",{unit:this}):this.deactivate(!0)}},{key:"destroy",value:function(){this.deactivate(!0),Me(e,"destroy",this,3)([]),Se(this)}},{key:"doAction",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;try{var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Te(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Re(t,this.row,this.col),2),i=r[0],o=r[1],a=n.getHex({row:i,col:o});Me(e,"setPath",this,3)([a,n]),Me(e,"moveOneStep",this,3)([])}catch(t){}}}],i=[{key:"isUnit",value:function(t){return t instanceof e}},{key:"isActivatableUnit",value:function(t){return e.isUnit(t)&&!1===t.deleted}},{key:"isMovableUnit",value:function(t){return e.isActivatableUnit(t)&&t.moves>0}}],r&&Pe(n.prototype,r),i&&Pe(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(Lt);function Le(t){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le(t)}function Ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fe(r.key),r)}}function Fe(t){var e=function(t){if("object"!=Le(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Le(e)?e:e+""}function De(t,e,n){Ue(t,e),e.set(t,n)}function Ue(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function He(t,e){return t.get(Ve(t,e))}function Ge(t,e,n){return t.set(Ve(t,e),n),n}function Ve(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}qe.isUnit;var Be=new WeakMap,ze=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,Je=new WeakMap,Xe=new WeakMap,$e=new WeakSet,Qe=function(){function t(e){var n=e.index;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Ue(t,e),e.add(t)}(this,$e),De(this,Be,null),De(this,ze,void 0),De(this,Ke,void 0),De(this,Ye,0),De(this,Je,void 0),De(this,Xe,[]),Ge(Ke,this,n),Ge(ze,this,function(t){var e;return null!==(e=[3329330,16711680,255][t])&&void 0!==e?e:11184810}(n)),Ge(Je,this,null==pt?void 0:pt.FactionNames[n]),Ve($e,this,Ze).call(this)}return e=t,n=[{key:"activeUnit",get:function(){if(Number.isInteger(He(Be,this))&&He(Be,this)>=0&&He(Be,this)<=He(Xe,this).length)return He(Xe,this)[He(Be,this)]},set:function(t){Number.isInteger(t)&&t>=0?Ge(Be,this,t%He(Xe,this).length):null===t&&Ge(Be,this,null)}},{key:"color",get:function(){return He(ze,this)}},{key:"index",get:function(){return He(Ke,this)}},{key:"money",get:function(){return He(Ye,this)},set:function(t){if(!Number.isFinite(t)||t<0)throw new TypeError("Faction.money expects to be assigned a positive number!");Ge(Ye,this,t)}},{key:"name",get:function(){return He(Je,this)}},{key:"nation",get:function(){return le.nations[0]}},{key:"units",get:function(){return He(Xe,this)},set:function(t){if(!Array.isArray(t))throw new TypeError("Faction.units expects to be assigned an Array!");Ge(Xe,this,t.filter(qe.isActivatableUnit))}},{key:"addUnit",value:function(t,e){He(Xe,this).push(new qe(t,{hex:e,faction:this}))}},{key:"checkEndTurn",value:function(){this.activateNext()||le.events.emit("end-turn",{faction:this})}},{key:"activateUnit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He(Be,this);return 0===He(Xe,this).length?(le.events.emit("end-turn",{faction:this}),!1):!!qe.isActivatableUnit(He(Xe,this)[t])&&(He(Xe,this)[t].activate(),Ge(Be,this,t),!0)}},{key:"activateNext",value:function(){var t=function(t,e){for(var n=0;n<t.length;n++){var r=(e+1+n)%t.length;if(qe.isMovableUnit(t[r]))return t[r]}return!1}(He(Xe,this),He(Be,this));return!!qe.isMovableUnit(t)&&(Ge(Be,this,He(Xe,this).indexOf(t)),t.activate(),!0)}}],r=[{key:"isFaction",value:function(e){return e instanceof t}}],n&&Ne(e.prototype,n),r&&Ne(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Ze(){var t=this;le.events.on("goods-moved",function(e){var n=e.detail,r=n.goods,i=n.promise;r.faction===t&&sr.isCity(r.hex.city)&&i.then(function(){Ge(Ye,t,He(Ye,t)+pt.ResourceValues[r.goodsType]*r.num),r.destroy()})}),le.events.on("unit-moved",function(e){e.detail.faction!==t&&e.detail.unit.faction!==t||e.detail.promise.then(function(){return t.checkEndTurn()})})}function tn(t){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tn(t)}function en(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nn(r.key),r)}}function nn(t){var e=function(t){if("object"!=tn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tn(e)?e:e+""}function rn(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function on(t,e){return t.get(sn(t,e))}function an(t,e,n){return t.set(sn(t,e),n),n}function sn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var cn=new WeakMap,un=new WeakMap,ln=new WeakMap,fn=new WeakMap,hn=function(){function t(e){var n,r,i,o=e.index;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),rn(this,cn,void 0),rn(this,un,void 0),rn(this,ln,void 0),rn(this,fn,void 0),an(ln,this,o),an(cn,this,null!==(n=[3329330,16711680,255][o])&&void 0!==n?n:11184810),an(un,this,(o+1)%3),an(fn,this,null!==(r=null===(i=pt.NationNames)||void 0===i?void 0:i[o])&&void 0!==r?r:"Unknown")}return e=t,r=[{key:"isNation",value:function(e){return e instanceof t}}],(n=[{key:"color",get:function(){return on(cn,this)}},{key:"frame",get:function(){return on(un,this)}},{key:"index",get:function(){return on(ln,this)}},{key:"name",get:function(){return on(fn,this)}}])&&en(e.prototype,n),r&&en(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function yn(t){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn(t)}function pn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function vn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pn(Object(n),!0).forEach(function(e){dn(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function dn(t,e,n){return(e=bn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bn(r.key),r)}}function bn(t){var e=function(t){if("object"!=yn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yn(e)?e:e+""}function gn(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function wn(t,e){return t.get(xn(t,e))}function kn(t,e,n){return t.set(xn(t,e),n),n}function xn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function Sn(t,e,n){var r;return!!dr(t)&&"string"==typeof e&&""!==e&&e in pt.improvements&&(""===n.key||n.key===e)&&t.terrain.terrain in(null===(r=pt.improvements[e])||void 0===r?void 0:r.terrains)&&!sr.isCity(t.city)}var On=new WeakMap,Tn=new WeakMap,Pn=new WeakMap,jn=new WeakMap,En=new WeakMap,Mn=new WeakMap,Cn=function(){function t(e){var n=e.hex;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gn(this,On,{faction:new Map,nation:new Map}),gn(this,Tn,void 0),gn(this,Pn,void 0),gn(this,jn,{key:""}),gn(this,En,new Set),gn(this,Mn,0),!dr(n))throw new TypeError("Tile expects to be assigned object instance of Hex!");kn(Tn,this,n)}return e=t,n=[{key:"faction",get:function(){var t={faction:null,claim:0};return wn(On,this).faction.forEach(function(e,n){t.claim<e&&(t.faction=n,t.claim=e)}),t.faction}},{key:"hex",get:function(){return wn(Tn,this)}},{key:"improvement",get:function(){return wn(Pn,this)||{}}},{key:"laborers",get:function(){return wn(En,this)},set:function(t){if(!Bn.isLaborer(t))throw new TypeError("Tile.laborers expects to be assigned object instance of Laborer!");wn(En,this).add(t)}},{key:"nation",get:function(){var t={nation:null,claim:0};return wn(On,this).nation.forEach(function(e,n){t.claim<e&&(t.nation=n,t.claim=e)}),t.nation}},{key:"claims",value:function(t,e){var n=null;return Qe.isFaction(t)?n="faction":hn.isNation(t)&&(n="nation"),n in wn(On,this)?(Number.isInteger(e)&&0!==e&&wn(On,this)[n].set(t,(wn(On,this)[n].get(t)||0)+e),wn(On,this)[n].get(t)||0):wn(On,this)}},{key:"claimTerritory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Number.isFinite(e)&&0!==e){var n,r=void 0;hn.isNation(t)&&hn.isNation(this.nation)?r=this.nation.index:Qe.isFaction(t)&&Qe.isFaction(this.faction)&&(r=this.faction.index),this.claims(t,e),Qe.isFaction(t)&&(null===(n=this.faction)||void 0===n?void 0:n.index)!==r&&(le.markTerritory(this.hex,{graphics:le.graphics.territoryFills,lineOffset:1,fill:!0}),le.markTerritory(this.hex,{graphics:le.graphics.territoryLines,lineOffset:.97,fill:!1}))}}},{key:"isValidImprovement",value:function(t){return Sn(wn(Tn,this),t,wn(jn,this))}},{key:"setImprovement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"destroy"===t?(kn(Pn,this,void 0),kn(jn,this,{key:""}),!0):!!Sn(wn(Tn,this),t,wn(jn,this))&&(kn(Pn,this,vn(vn(vn({},pt.improvements[t]),pt.improvements[t].terrains[wn(Tn,this).terrain.terrain]),{},{key:t})),e instanceof Qe&&(this.claimTerritory(e,10),wn(Pn,this).faction=e),wn(jn,this).key=t,!0)}}],r=[{key:"isTile",value:function(e){return e instanceof t}}],n&&mn(e.prototype,n),r&&mn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function An(t){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(t)}function In(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rn(r.key),r)}}function Wn(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function Rn(t){var e=function(t){if("object"!=An(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=An(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==An(e)?e:e+""}function _n(t,e){return t.get(Ln(t,e))}function qn(t,e,n){return t.set(Ln(t,e),n),n}function Ln(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Nn,Fn,Dn=new WeakMap,Un=new WeakMap,Hn=new WeakMap,Gn=new WeakMap,Vn=new WeakMap,Bn=function(){function t(){var e,n,r,i,o,a,s,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=c.city,l=(c.faction,c.hex),f=c.tile,h=c.type;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Wn(this,Dn,void 0),Wn(this,Un,void 0),Wn(this,Hn,void 0),Wn(this,Gn,void 0),Wn(this,Vn,void 0),qn(Hn,this,(e=["Gaius","Lucius","Marcus","Quintus","Titus","Publius","Aulus","Sextus"],n=["Bran","Cai","Elen","Rhiannon","Taran","Mabon","Nia","Owain"],r=["Agricola","Felix","Silvanus","Varus","Florus","Crispus","Severus","Vitalis"],i=["the Smith","of Londinium","the Younger","the Red","from Camulodunum","the Hunter"],o=Math.random()<.5?e[Math.floor(Math.random()*e.length)]:n[Math.floor(Math.random()*n.length)],a=r[Math.floor(Math.random()*r.length)],s=Math.random()<.3?i[Math.floor(Math.random()*i.length)]:"","".concat(o," ").concat(a," ").concat(s).trim())),qn(Vn,this,h),sr.isCity(u)&&qn(Dn,this,u),(dr(l)||dr(null==f?void 0:f.hex))&&qn(Un,this,l||(null==f?void 0:f.hex)),(Cn.isTile(f)||Cn.isTile(null==l?void 0:l.tile))&&qn(Gn,this,f||(null==l?void 0:l.tile))}return e=t,r=[{key:"isLaborer",value:function(e){return e instanceof t}}],(n=[{key:"city",get:function(){return _n(Dn,this)}},{key:"hex",get:function(){return _n(Un,this)}},{key:"name",get:function(){return _n(Hn,this)}},{key:"tile",get:function(){return _n(Gn,this)},set:function(t){if(!Cn.isTile(t))throw new TypeError("Laborer.tile expects to be assigned object instance of Tile!");qn(Gn,this,t)}},{key:"type",get:function(){return _n(Vn,this)}},{key:"assignTile",value:function(t){if(!Cn.isTile(t))throw new TypeError("Laborer.assignTile expects to be passed object instance of Tile!");this.tile=t}}])&&In(e.prototype,n),r&&In(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function zn(t){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zn(t)}function Kn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yn(r.key),r)}}function Yn(t){var e=function(t){if("object"!=zn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=zn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zn(e)?e:e+""}function Jn(t,e,n){Xn(t,e),e.set(t,n)}function Xn(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $n(t,e){return t.get(Zn(t,e))}function Qn(t,e,n){return t.set(Zn(t,e),n),n}function Zn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}Nn=Bn,(Fn=Rn(Fn="FOOD_CONSUMPTION"))in Nn?Object.defineProperty(Nn,Fn,{value:2,enumerable:!0,configurable:!0,writable:!0}):Nn[Fn]=2;var tr=new WeakMap,er=new WeakMap,nr=new WeakMap,rr=new WeakMap,ir=new WeakMap,or=new WeakMap,ar=new WeakSet,sr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.col,r=e.row,i=e.level,o=void 0===i?1:i,a=e.nation;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Xn(t,e),e.add(t)}(this,ar),Jn(this,tr,void 0),Jn(this,er,new Set),Jn(this,nr,void 0),Jn(this,rr,void 0),Jn(this,ir,[]),Jn(this,or,void 0),!hn.isNation(a))throw new TypeError("City expects to be assigned a Nation!");var s=le.scenes.getScene("mainGameScene"),c=mr.getHex({row:r,col:n});c.tile.setImprovement("destroy"),Qn(tr,this,c),Qn(nr,this,o),Qn(rr,this,a),Qn(or,this,s.add.image(c.x,c.y,"cities",a.frame).setDepth(10).setScale(.8)),c.city=this,Zn(ar,this,cr).call(this)}return function(t,e,n){return e&&Kn(t.prototype,e),n&&Kn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"hex",get:function(){return $n(tr,this)}},{key:"laborers",get:function(){return $n(er,this)},set:function(t){if(!(t instanceof Bn))throw new TypeError("City.laborers expects to be assigned object instance of Laborer!");$n(er,this).add(t)}},{key:"level",get:function(){return $n(nr,this)}},{key:"nation",get:function(){return $n(rr,this)}},{key:"queue",get:function(){return $n(ir,this)}},{key:"sprite",get:function(){return $n(or,this)}},{key:"addToQueue",value:function(t){var e=t.faction,n=t.unitType;n in pt.units?$n(ir,this).push({unitType:n,faction:e}):console.warn("City production queue: Unknown unit key ".concat(n))}}],[{key:"isCity",value:function(e){return e instanceof t}}])}();function cr(){var t=this;mr.traverse(nt({start:[$n(tr,this).q,$n(tr,this).r],radius:1})).forEach(function(e){e.tile.claimTerritory($n(rr,t),100)}),mr.traverse(tt({center:[$n(tr,this).q,$n(tr,this).r],radius:2})).forEach(function(e){e.terrain.isWater&&e.tile.claimTerritory($n(rr,t),50)})}function ur(t){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ur(t)}function lr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(lr=function(){return!!t})()}function fr(t){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fr(t)}function hr(t,e){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hr(t,e)}function yr(t,e,n){return(e=pr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pr(t){var e=function(t){if("object"!=ur(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ur(e)?e:e+""}var vr=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return yr(t=function(t,e,n){return e=fr(e),function(t,e){if(e&&("object"==ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lr()?Reflect.construct(e,n||[],fr(t).constructor):e.apply(t,n))}(this,e,[].concat(r)),"f_cost",void 0),yr(t,"h_cost",void 0),yr(t,"g_cost",void 0),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}(e,t),function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(e)}(W({dimensions:100,orientation:E.FLAT,origin:"topLeft"}));function dr(t){return t instanceof M}var mr=new at(vr,$({width:15,height:6}));function br(t,e){if(!dr(t))return!1;if(!Lt.isInstanceofMovable(e))return!1;if(qe.isUnit(e)){if(sr.isCity(t.city)&&t.city.nation!==e.faction.nation&&(!e.attack||!e.attackCities))return!1}else Zt.isGoods(e);var n=gr(e,t);return!!Number.isFinite(n)&&n<=e.baseMovementPoints}function gr(t,e){var n,r,i;return arguments.length>2&&void 0!==arguments[2]||t.hex,dr(e)&&Lt.isInstanceofMovable(t)?e.terrain.isWater&&!t.moveOnWater?null!==(i=t.movementCosts[e.terrain.terrain])&&void 0!==i?i:1/0:null!==(n=null!==(r=t.movementCosts[e.terrain.terrain])&&void 0!==r?r:e.terrain.movementCost)&&void 0!==n?n:1/0:1/0}function wr(t){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wr(t)}function kr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function xr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tr(r.key),r)}}function Or(t,e,n){return e&&Sr(t.prototype,e),n&&Sr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tr(t){var e=function(t){if("object"!=wr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wr(e)?e:e+""}function Pr(t,e,n){jr(t,e),e.set(t,n)}function jr(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Er(t,e){return t.get(Mr(t,e))}function Mr(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Cr=new WeakMap,Ar=new WeakMap,Ir=new WeakMap,Wr=function(){return Or(function t(e){var n=this;xr(this,t),Pr(this,Cr,void 0),Pr(this,Ar,void 0),Pr(this,Ir,void 0),["execute","isValid","label"].forEach(function(t){t in e&&(n["#".concat(t)]=e[t],delete e[t])}),Object.assign(this,e)},[{key:"isValid",value:function(t){var e;if("string"==typeof t.menu&&(null===(e=this.showIn)||void 0===e||!e.includes(t.menu)))return!1;if(!0===Er(Ar,this))return!0;if(Array.isArray(this.unitTypes)&&(!qe.isUnit(t.unit)||!this.unitTypes.includes(t.unit.unitType)))return!1;var n=Hr[Er(Ar,this)];return"function"!=typeof n||n(t)}},{key:"execute",value:function(t){var e=Gr[Er(Cr,this)];return!!this.isValid(t)&&("function"==typeof e?Promise.resolve().then(function(){le.events.emit("doing-action")}).then(function(){e(t)}):void console.warn("No executor for action ".concat(this.key)))}},{key:"label",get:function(){var t=Vr[Er(Ir,this)];return"function"==typeof t?t():Er(Ir,this)}}])}(),Rr=new Map,_r=new WeakSet,qr=function(){function t(){if(xr(this,t),function(t,e){jr(t,e),e.add(t)}(this,_r),Fr._)return Fr._;Fr._=this,Mr(_r,this,Lr).call(this),Mr(_r,this,Nr).call(this)}return Or(t,[{key:"handle",value:function(t,e){var n=Rr.get(t);return n instanceof Wr&&!!n.isValid(e)&&(n.execute(e),!0)}},{key:"getAvailableActions",value:function(t){return function(t){return function(t){if(Array.isArray(t))return kr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return kr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kr(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Rr.values()).filter(function(e){return e.isValid(t)})}}],[{key:"getInstance",value:function(){return Fr._||new t,Fr._}}])}();function Lr(){var t;null===(t=pt.actions)||void 0===t||t.forEach(function(t){var e=new Wr(t);Rr.set(e.key,e)})}function Nr(){var t=this;le.events.on("key-pressed",function(e){var n=e.detail,r=le.activeUnit;if(qe.isUnit(r)){var i={unit:r,hex:r.hex,faction:r.faction};t.handle(n,i)}})}var Fr={_:void 0},Dr=function(){return Or(function t(){xr(this,t)},null,[{key:"handle",value:function(t,e){return qr.getInstance().handle(t,e)}},{key:"getAvailableActions",value:function(t){return qr.getInstance().getAvailableActions(t)}}])}();new qr;var Ur,Hr={currentPlayerTurn:function(){return le.currentPlayer===le.players[0]},hexTileValid:function(t){var e=t.hex;return dr(e)&&Cn.isTile(e.tile)},isCityTile:function(t){var e=t.hex;return sr.isCity(e.city)},isFarmBuildable:function(t){var e=t.hex,n=t.unit;return e===n.hex&&!!Hr.hexTileValid({hex:e})&&"farmer"===n.unitType&&e.tile.isValidImprovement("farm")},isHexControlled:function(t){var e=t.hex,n=t.faction;return e.tile.faction===n},isLegalMove:function(t){var e=t.hex,n=t.unit;return e!==n.hex&&br(e,n)}},Gr={buildFarm:function(t){var e=t.unit,n=t.hex;n.tile.setImprovement("farm",e.faction),n.tile.laborers=new Bn({hex:n,faction:e.faction,type:"farmer"}),e.destroy()},endTurn:function(){le.events.emit("end-turn")},skip:function(t){t.unit.deactivate(!0)},startCityView:function(t){var e=t.hex;le.scenes.start("city-view",{hex:e})},startMoveTo:function(t){var e=t.unit,n=t.hex;e.setPath(n)&&e.moveOneTurn()},startTileView:function(t){var e=t.hex;le.scenes.start("tile-view",{hex:e})},wait:function(t){t.unit.deactivate()}},Vr={};function Br(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function zr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Br(Object(n),!0).forEach(function(e){Xr(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Kr(t){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kr(t)}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Jr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$r(r.key),r)}}function Xr(t,e,n){return(e=$r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $r(t){var e=function(t){if("object"!=Kr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kr(e)?e:e+""}function Qr(t,e,n){Zr(t,e),e.set(t,n)}function Zr(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ti(t,e){return t.get(ni(t,e))}function ei(t,e,n){return t.set(ni(t,e),n),n}function ni(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var ri="empires4x_",ii={_version:1,_lastModified:null,movementKeys:"default",customMovementKeys:{upLeft:"U",up:"I",upRight:"O",downLeft:"J",down:"K",downRight:"L"},dragThreshold:4,masterVolume:.7,musicVolume:.5,sfxVolume:.8,showGrid:!0,showTerritoryBorders:!0,animationSpeed:1,highContrast:!1,reducedMotion:!1,screenReaderMode:!1},oi="operational",ai="degraded",si="failed",ci=new WeakMap,ui=new WeakMap,li=new WeakMap,fi=new WeakMap,hi=new WeakMap,yi=new WeakSet,pi=function(){return function(t,e){return e&&Jr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Zr(t,e),e.add(t)}(this,yi),Qr(this,ci,null),Qr(this,ui,oi),Qr(this,li,0),Qr(this,fi,0),Qr(this,hi,null),ni(yi,this,vi).call(this)},[{key:"get",value:function(t){ti(ci,this)||ni(yi,this,vi).call(this);var e,n=t.split("."),r=ti(ci,this),i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Yr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(!r||"object"!==Kr(r)||!(o in r))return;r=r[o]}}catch(t){i.e(t)}finally{i.f()}return r}},{key:"set",value:function(t,e){if(ti(ci,this)||ni(yi,this,vi).call(this),"string"!=typeof t||0===t.length)return console.error("Invalid setting key"),!1;if(!ni(yi,this,wi).call(this,t,e))return console.error("Invalid value for setting \"".concat(t,"\":"),e),!1;for(var n=t.split("."),r=ti(ci,this),i=0;i<n.length-1;i++){var o=n[i];o in r&&"object"===Kr(r[o])||(r[o]={}),r=r[o]}return r[n[n.length-1]]=e,ni(yi,this,bi).call(this),!0}},{key:"reset",value:function(){ei(ci,this,zr({},ii)),ni(yi,this,bi).call(this)}},{key:"resetKey",value:function(t){t in ii&&this.set(t,ii[t])}},{key:"export",value:function(){return JSON.stringify(ti(ci,this),null,2)}},{key:"import",value:function(t){try{var e=JSON.parse(t);if("object"!==Kr(e)||null===e)throw new Error("Invalid settings format");return ei(ci,this,zr(zr({},ii),e)),ni(yi,this,bi).call(this),!0}catch(t){return console.error("Failed to import settings:",t),!1}}}])}();function vi(){try{var t=localStorage.getItem("".concat(ri,"settings"));if(t){var e=JSON.parse(t);1!==e._version?(console.warn("Settings schema outdated (v".concat(e._version,"). Migrating to v").concat(1)),ei(ci,this,ni(yi,this,gi).call(this,e))):ei(ci,this,zr(zr({},ii),e))}else ei(ci,this,zr({},ii)),ni(yi,this,bi).call(this);ei(ui,this,oi),ei(li,this,0)}catch(t){console.error("Failed to load settings from localStorage:",t),ni(yi,this,di).call(this),ei(ci,this,zr({},ii))}}function di(){var t;ei(li,this,(t=ti(li,this),++t)),ei(fi,this,Date.now()),ti(li,this)>=Ur.FAILURE_THRESHOLD?(ei(ui,this,si),console.error("localStorage circuit breaker OPEN - too many failures")):ei(ui,this,ai)}function mi(){return ti(ui,this)===oi||ti(ui,this)!==si||Date.now()-ti(fi,this)>=Ur.RECOVERY_TIMEOUT&&(console.info("Attempting localStorage recovery..."),ei(ui,this,ai),ei(li,this,0),!0)}function bi(){var t=this;ni(yi,this,mi).call(this)?(clearTimeout(ti(hi,this)),ei(hi,this,setTimeout(function(){try{ti(ci,t)._lastModified=new Date().toISOString();var e=JSON.stringify(ti(ci,t));localStorage.setItem("".concat(ri,"settings"),e),ti(ui,t)!==oi&&(console.info("localStorage recovered"),ei(ui,t,oi),ei(li,t,0))}catch(e){console.error("Failed to persist settings:",e),ni(yi,t,di).call(t)}},Ur.WRITE_DEBOUNCE_MS))):console.warn("localStorage unavailable - settings not persisted")}function gi(t){return zr(zr(zr({},ii),t),{},{_version:1})}function wi(t,e){switch(t){case"dragThreshold":return"number"==typeof e&&e>=1&&e<=50;case"movementKeys":return["default","wasd","arrows","custom"].includes(e);case"masterVolume":case"musicVolume":case"sfxVolume":return"number"==typeof e&&e>=0&&e<=1;case"animationSpeed":return"number"==typeof e&&e>=.1&&e<=3;case"showGrid":case"showTerritoryBorders":case"highContrast":case"reducedMotion":case"screenReaderMode":return"boolean"==typeof e;default:return!0}}function ki(){try{var t=localStorage.getItem("".concat(ri,"savegame_backup"));return t?JSON.parse(t).state:null}catch(t){return console.error("Failed to load backup game:",t),null}}function xi(){try{return null!==localStorage.getItem("".concat(ri,"savegame"))}catch(t){return!1}}Ur=pi,Xr(pi,"FAILURE_THRESHOLD",3),Xr(pi,"RECOVERY_TIMEOUT",3e4),Xr(pi,"WRITE_DEBOUNCE_MS",500);const Si=new pi;function Oi(t,e){return Ei(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||Pi(t,e)||Ti()}function Ti(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pi(t,e){if(t){if("string"==typeof t)return ji(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ji(t,e):void 0}}function ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Ei(t){if(Array.isArray(t))return t}function Mi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Ci(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mi(Object(n),!0).forEach(function(e){Ai(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mi(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Ai(t,e,n){return(e=Ri(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ii(t){return Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ii(t)}function Wi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ri(r.key),r)}}function Ri(t){var e=function(t){if("object"!=Ii(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ii(e)?e:e+""}function _i(t,e,n){qi(t,e),e.set(t,n)}function qi(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Li(t,e){return t.get(Fi(t,e))}function Ni(t,e,n){return t.set(Fi(t,e),n),n}function Fi(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Di={global:{Escape:{action:"escape",description:"Close menu or open settings"},F1:{action:"open-settings",description:"Open settings"}},mainGame:{w:{action:"unit-wait",description:"Wait with current unit"},s:{action:"unit-skip",description:"Skip current unit"},F:{action:"build-farm",description:"Build farm (farmer unit)"},F2:{action:"clear-claims",description:"Clear territorial claims display"},F3:{action:"show-claims",description:"Show territorial claims"},u:{action:"move-upleft",description:"Move unit up-left",movement:!0},i:{action:"move-up",description:"Move unit up",movement:!0},o:{action:"move-upright",description:"Move unit up-right",movement:!0},j:{action:"move-downleft",description:"Move unit down-left",movement:!0},k:{action:"move-down",description:"Move unit down",movement:!0},l:{action:"move-downright",description:"Move unit down-right",movement:!0}},cityView:{Escape:{action:"close-city-view",description:"Close city view"}},tileView:{Escape:{action:"close-tile-view",description:"Close tile view"}},settings:{Escape:{action:"close-settings",description:"Close settings"}}},Ui=new WeakMap,Hi=new WeakMap,Gi=new WeakMap,Vi=new WeakMap,Bi=new WeakMap,zi=new WeakMap,Ki=new WeakMap,Yi=new WeakMap,Ji=new WeakMap,Xi=new WeakSet,$i=function(){return function(t,e,n){return e&&Wi(t.prototype,e),n&&Wi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){qi(t,e),e.add(t)}(this,Xi),_i(this,Ui,void 0),_i(this,Hi,void 0),_i(this,Gi,void 0),_i(this,Vi,void 0),_i(this,Bi,!1),_i(this,zi,{x:0,y:0}),_i(this,Ki,{x:0,y:0}),_i(this,Yi,null),_i(this,Ji,{}),!(e instanceof globalThis.Phaser.Scene))throw new Error("InputManager requires a Phaser.Scene instance");Ni(Ui,this,e),Ni(Hi,this,e.scene.key),Ni(Vi,this,e.input.keyboard.addKey(globalThis.Phaser.Input.Keyboard.KeyCodes.SHIFT)),Fi(Xi,this,Qi).call(this)},[{key:"update",value:function(){if("mainGameScene"===Li(Hi,this)&&Li(Gi,this)){var t=Li(Ui,this).cameras.main,e=Li(Vi,this).isDown?25:5;Li(Gi,this).left.isDown?t.scrollX-=e:Li(Gi,this).right.isDown&&(t.scrollX+=e),Li(Gi,this).up.isDown?t.scrollY-=e:Li(Gi,this).down.isDown&&(t.scrollY+=e)}}},{key:"enableKeyboardInput",value:function(){var t,e=null===(t=Li(Ui,this).input)||void 0===t?void 0:t.keyboard;"object"===Ii(null!=e&&e)&&(e.enabled=!0,"mainGameScene"===Li(Hi,this)&&Ni(Gi,this,e.createCursorKeys()))}},{key:"disableKeyboardInput",value:function(){var t,e=null===(t=Li(Ui,this).input)||void 0===t?void 0:t.keyboard;"object"===Ii(null!=e&&e)&&(e.enabled=!1,e.removeCapture("SPACE"),e.removeCapture("UP"),e.removeCapture("DOWN"),e.removeCapture("LEFT"),e.removeCapture("RIGHT"))}},{key:"destroy",value:function(){Li(Yi,this)&&Li(Ui,this).input.keyboard.off("keydown",Li(Yi,this)),Li(Ji,this).down&&(Li(Ui,this).input.off("pointerdown",Li(Ji,this).down),Li(Ui,this).input.off("pointermove",Li(Ji,this).move),Li(Ui,this).input.off("pointerup",Li(Ji,this).up)),Ni(Yi,this,null),Ni(Ji,this,{})}}],[{key:"getShortcuts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Ci(Ci({},Di.global),Di[t]||{}):Di}},{key:"getAllShortcuts",value:function(){var t={};return Object.entries(Di).forEach(function(e){var n=Oi(e,2),r=n[0],i=n[1];Object.entries(i).forEach(function(e){var n=Oi(e,2),i=n[0],o=n[1];t[r]||(t[r]=[]),t[r].push(Ci({key:i},o))})}),t}}])}();function Qi(){switch(Li(Hi,this)){case"mainGameScene":Fi(Xi,this,Zi).call(this);break;case"city-view":Fi(Xi,this,to).call(this);break;case"tile-view":Fi(Xi,this,eo).call(this);break;case"settings":Fi(Xi,this,no).call(this);break;default:console.warn("No input configuration for scene: ".concat(Li(Hi,this)))}}function Zi(){Fi(Xi,this,ro).call(this),Fi(Xi,this,io).call(this),Fi(Xi,this,lo).call(this),this.enableKeyboardInput()}function to(){var t=this;Ni(Yi,this,function(e){"Escape"===e.key&&(le.events.emit("input:close-city-view"),Li(Ui,t).scene.stop("city-view"))}),Li(Ui,this).input.keyboard.on("keydown",Li(Yi,this))}function eo(){var t=this;Fi(Xi,this,ro).call(this,"#tile-view"),Ni(Yi,this,function(e){"Escape"===e.key&&(le.events.emit("input:close-tile-view"),Li(Ui,t).scene.stop("tile-view"))}),Li(Ui,this).input.keyboard.on("keydown",Li(Yi,this)),this.enableKeyboardInput()}function no(){Ni(Yi,this,function(t){"Escape"===t.key&&le.events.emit("input:close-settings")}),Li(Ui,this).input.keyboard.on("keydown",Li(Yi,this))}function ro(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=e?document.querySelector(e):le.domContainer;n&&n.addEventListener("contextmenu",function(t){return t.preventDefault()}),null!==(t=Li(Ui,this).input)&&void 0!==t&&null!==(t=t.manager)&&void 0!==t&&t.canvas&&Li(Ui,this).input.manager.canvas.addEventListener("contextmenu",function(t){return t.preventDefault()})}function io(){var t=this;Ni(Yi,this,function(e){if(!e.ctrlKey||!["r","R","1","2","3","4","5","6","7","8","9","I"].includes(e.key)){e.preventDefault();var n=Ci(Ci({},Di.global),Di.mainGame)[e.key];n&&(n.movement?Fi(Xi,t,oo).call(t,e.key):Fi(Xi,t,ao).call(t,n.action))}}),Li(Ui,this).input.keyboard.on("keydown",Li(Yi,this))}function oo(t){qe.isMovableUnit(le.activeUnit)&&(le.events.emit("input:unit-move",{direction:t,unit:le.activeUnit}),le.activeUnit.doAction(t))}function ao(t){var e;switch(t){case"escape":Fi(Xi,this,so).call(this);break;case"open-settings":Fi(Xi,this,co).call(this);break;case"unit-wait":le.events.emit("input:unit-wait"),le.events.emit("key-pressed","wait");break;case"unit-skip":le.events.emit("input:unit-skip"),le.events.emit("key-pressed","skip");break;case"build-farm":le.events.emit("input:build-farm"),le.events.emit("key-pressed","build-farm");break;case"clear-claims":le.events.emit("input:clear-claims"),null===(e=le.graphics.gfxClaims)||void 0===e||e.destroy();break;case"show-claims":le.events.emit("input:show-claims"),Fi(Xi,this,uo).call(this);break;default:le.events.emit("input:".concat(t))}}function so(){var t=document.getElementById("tile-menu"),e=document.getElementById("tile-view");t&&!t.hidden?(le.events.emit("input:close-menu",{menu:"tile-menu"}),le.events.emit("esc-pressed")):e&&!e.hidden?(le.events.emit("input:close-menu",{menu:"tile-view"}),le.events.emit("esc-pressed")):(le.events.emit("input:open-settings"),Fi(Xi,this,co).call(this))}function co(){"mainGameScene"===Li(Hi,this)&&(Li(Ui,this).scene.get("settings")?(Li(Ui,this).scene.launch("settings",{returnScene:"mainGameScene"}),Li(Ui,this).scene.pause()):console.warn("Settings scene not found"))}function uo(){var t=le.graphics.gfxClaims=Li(Ui,this).add.graphics({x:0,y:0}).setDepth(1);mr.forEach(function(e){Cn.isTile(e.tile)&&e.tile.claims()instanceof Map&&e.tile.claims().forEach(function(n,r){if(e.tile.player!==r){t.lineStyle(3,r.color),t.beginPath();var i=function(t){return Ei(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Pi(t)||Ti()}(e.corners.map(function(t){return yt(t,e,.9)})),o=i[0],a=i.slice(1);t.moveTo(o.x,o.y),a.forEach(function(e){var n=e.x,r=e.y;t.lineTo(n,r)}),t.closePath(),t.strokePath()}})})}function lo(){var t=this,e=function(){return Si.get("dragThreshold")||4};Li(Ji,this).down=function(n){Li(zi,t).x=n.x,Li(zi,t).y=n.y,Li(Ki,t).x=Li(Ui,t).cameras.main.scrollX,Li(Ki,t).y=Li(Ui,t).cameras.main.scrollY,Ni(Bi,t,!1);var r,i=e();switch(n.pointerType){case"touch":r=2.5*i;break;case"pen":r=2*i;break;default:r=i}n.customDragThreshold=r},Li(Ji,this).move=function(n){if(n.isDown){var r=n.x-Li(zi,t).x,i=n.y-Li(zi,t).y,o=n.customDragThreshold||e();if(!Li(Bi,t)&&(Math.abs(r)>o||Math.abs(i)>o)&&(Ni(Bi,t,!0),le.events.emit("input:drag-start",{x:n.x,y:n.y})),Li(Bi,t)){var a=Li(Ui,t).cameras.main.zoom||1;Li(Ui,t).cameras.main.setScroll(Li(Ki,t).x-r/a,Li(Ki,t).y-i/a),le.events.emit("input:drag-move",{dx:r,dy:i})}}},Li(Ji,this).up=function(e){if(Li(Bi,t))le.events.emit("input:drag-end",{x:e.x,y:e.y});else{var n=mr.pointToHex({x:e.worldX,y:e.worldY});dr(n)&&(le.events.emit("input:hex-click",{hex:n,pointer:e}),le.events.emit("hex-clicked",{hex:n}))}Ni(Bi,t,!1)},Li(Ui,this).input.on("pointerdown",Li(Ji,this).down),Li(Ui,this).input.on("pointermove",Li(Ji,this).move),Li(Ui,this).input.on("pointerup",Li(Ji,this).up)}var fo=null,ho=null;function yo(){ho&&(ho.setAttribute("hidden","true"),ho.innerHTML="")}const po={key:"city-view",preload:function(){},create:function(t){var e=this;if(dr(t.hex)&&Cn.isTile(t.hex.tile)&&sr.isCity(t.hex.city)){this.scene.pause("mainGameScene"),this.scene.moveAbove("mainControls","city-view");var n=ht();fo=t.hex.city,null!=ho||(ho=document.getElementById("production-queue")),ho.innerHTML="";var r=document.createElement("select"),i=document.createElement("option");i.text="-- Select Unit Type --",i.value="",r.appendChild(i),Object.keys(pt.units).forEach(function(t){var e=document.createElement("option");e.value=t,e.text=pt.units[t].name,r.appendChild(e)}),ho.appendChild(r);var o=document.createElement("button");o.innerText="Add to Queue",o.addEventListener("click",function(){fo.addToQueue({faction:le.currentPlayer,unitType:r.options[r.selectedIndex].value})}),o.disabled=!0,ho.appendChild(o),r.addEventListener("change",function(){o.disabled=""===r.options[r.selectedIndex].value}),ho.appendChild(document.createElement("ul")),ho.removeAttribute("hidden"),ho.style.zIndex=1;var a=this.add.graphics({x:0,y:0}).setDepth(0);a.fillStyle(0,.5),a.fillRect(0,0,n.width,n.height);var s=this.add.graphics({x:0,y:0}).setDepth(1);s.fillStyle(0,1),s.fillRect(n.width-100,0,100,100),this.add.text(n.width-100,0,"\xD7 ",{fixedWidth:100,fixedHeight:100,font:"60pt Trebuchet MS",align:"right",color:"white",stroke:"black",strokeThickness:7}).setDepth(2).setInteractive().on("pointerdown",function(){e.scene.stop("city-view")});var c=[t.hex.x,t.hex.y],u=c[0],l=c[1],f=Math.min(n.height,n.width)/7/ft,h=n.width/2,y=n.height/3;mr.traverse(nt({start:[t.hex.q,t.hex.r],radius:2})).forEach(function(t){var n={x:(t.x-u)*f+h,y:(t.y-l)*f+y},r=e.add.image(n.x,n.y,"tile.".concat(t.terrain.terrain)).setDepth(1);if(r.scaleX=f,r.scaleY=f,le.markTerritory(t,{offsetX:0-t.x+h+(t.x-u)*f,offsetY:0-t.y+y+(t.y-l)*f,graphics:s.setDepth(2),lineOffset:.95*f}),t.tile.laborers.size>0){var i=ft*f;e.add.text(n.x-i/2,n.y+i/4,"Food: ".concat((t.terrain.food||0)+(t.tile.improvement.food||0)),{font:"14pt Trebuchet MS",align:"center",color:"white",stroke:"black",strokeThickness:7,fixedWidth:i}).setDepth(3)}}),this.inputManager=new $i(this),this.events.on("sleep",function(){yo(),e.scene.wake("mainGameScene")}).on("shutdown",function(){yo(),e.scene.wake("mainGameScene")})}else this.scene.resume("mainGameScene")},update:function(){if(fo){var t=document.querySelector("#production-queue > ul");t&&t.querySelectorAll("li").length!==fo.queue.length&&(t.innerHTML="",fo.queue.forEach(function(e){var n=e.faction,r=e.unitType,i=document.createElement("li");i.innerText="".concat(n.name,": ").concat(pt.units[r].name),t.appendChild(i)}))}}};var vo="mainControls",mo=new Map,bo=new Map;const go={key:vo,autoStart:!0,preload:function(){this.load.image("coins","img/resources/coins.png")},create:function(){var t=le.graphics.mainControls=this.add.graphics({x:0,y:0}),e=15;mo.set("round",this.add.text(14,e,"Round ".concat(le.turn),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),mo.set("faction",this.add.text(14+mo.get("round").displayWidth+10,e+2,"",{fontFamily:"Trebuchet MS",fontSize:"26px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),e+=mo.get("faction").displayHeight+5,e-=15;var n=this.add.image(0,e,"coins").setDepth(2);n.setScale(32/n.width),n.x=20+n.displayWidth/2,n.y=e+=20+n.displayHeight/2,mo.set("money",this.add.text(n.x+n.displayWidth/2+6,n.y-n.displayHeight/2-4,le.players[0].money.toLocaleString("en-Us"),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"gold",stroke:"black",strokeThickness:5,maxLines:1}).setLetterSpacing(1)),bo.set("money",n),e+=mo.get("money").displayHeight,t.fillStyle(0,.5),t.fillRect(0,0,ht().width,e),this.game.events.emit("scene-created-".concat(vo))},update:function(){mo.forEach(function(t,e){switch(e){case"money":if(t.oldValue===le.players[0].money)return;return mo.get("money").setText(le.players[0].money.toLocaleString("en-Us")),void(t.oldValue=le.players[0].money);case"faction":if(!le.currentPlayer)return;if(t.oldValue===le.currentPlayer.name)return;return void mo.get("faction").setText("".concat(le.currentPlayer.name,"'s Turn")).setX(14+mo.get("round").displayWidth+10).setColor(0===le.currentPlayer.index?"goldenrod":"lightgrey");case"round":if(le.betweenRounds)return void mo.get("faction").setX(14+mo.get("round").displayWidth+10).setText("End of Round").setColor("lightgrey")}})}};function wo(t){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wo(t)}function ko(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xo(r.key),r)}}function xo(t){var e=function(t){if("object"!=wo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=wo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wo(e)?e:e+""}function So(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function Oo(t,e){return t.get(Po(t,e))}function To(t,e,n){return t.set(Po(t,e),n),n}function Po(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var jo=new Map,Eo=new WeakMap,Mo=new WeakMap,Co=new WeakMap,Ao=function(){return function(t,e){return e&&ko(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),So(this,Eo,void 0),So(this,Mo,void 0),So(this,Co,void 0),To(Eo,this,{x:e.hex.x,y:e.hex.y}),To(Mo,this,n),To(Co,this,n.add.sprite(Oo(Eo,this).x,Oo(Eo,this).y,"goods.".concat(e.goodsType)).setDepth(20))},[{key:"scene",get:function(){return Oo(Mo,this)}},{key:"sprite",get:function(){return Oo(Co,this)}},{key:"x",get:function(){return Oo(Eo,this).x}},{key:"y",get:function(){return Oo(Eo,this).y}},{key:"update",value:function(t){Oo(Eo,this).x=t.x,Oo(Eo,this).y=t.y}}])}();var Io=new Map;function Wo(t){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wo(t)}function Ro(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ro(Object(n),!0).forEach(function(e){qo(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ro(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function qo(t,e,n){return(e=function(t){var e=function(t){if("object"!=Wo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Wo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wo(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Lo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return No(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?No(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function No(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var Fo="mainGameScene",Do=null,Uo={spriteOnActiveUnit:null,shortcutKeys:[]};function Ho(){var t;if(void 0!==globalThis.Phaser){var e=ht();for(null===(t=Uo.spriteOnActiveUnit)||void 0===t||t.setActive(!1).setPosition(e.offscreen,e.offscreen).setDepth(0);Uo.shortcutKeys.length>0;)Uo.shortcutKeys.pop().destroy()}}le.events.on("unit-deactivated",Ho),le.events.on("unit-moving",Ho),le.events.on("unit-activated",function(t){Ho(),function(t){if(void 0!==globalThis.Phaser){var e=t.detail.unit,n=e.hex;Uo.spriteOnActiveUnit.setActive(!0).setVisible(!0).setPosition(n.x,n.y).setDepth(98),["L","K","J","U","I","O"].forEach(function(t){var n=Lo(Re(t.toLowerCase(),e.row,e.col),2),r=n[0],i=n[1],o=mr.getHex({row:r,col:i});if(br(o,e)){var a=Do.add.text(o.x-100,o.y+ft/6,t,{fixedWidth:ft,font:"25pt Trebuchet MS",align:"center",color:"khaki",stroke:"black",strokeThickness:7}).setOrigin(0).setDepth(98);Uo.shortcutKeys.push(a),Do.cameras.getCamera("mini").ignore(a)}})}}(t)}),le.events.on("unit-activated",function(t){if(void 0!==globalThis.Phaser){var e=t.detail.unit.hex;Do.cameras.main.pan(e.x,e.y,500,"Linear",!0)}}),le.events.on("unit-created",function(t){var e,n;e=t.detail.unit,n=Do,be.has(e)||be.set(e,new xe(e,n)),be.has(e)}),le.events.on("goods-created",function(t){var e,n;e=t.detail.goods,n=Do,jo.has(e)||jo.set(e,new Ao(e,n)),jo.has(e)});const Go={key:Fo,autoStart:!0,preload:function(){var t=this;Object.entries(pt.terrains).forEach(function(e){var n=Lo(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("tile.".concat(r),"img/tiles/".concat(i.tile,".png"))}),this.load.spritesheet("cities","img/tiles/cities.png",{frameHeight:200,frameWidth:200}),Object.entries(pt.improvements).forEach(function(e){var n=Lo(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))}),Object.entries(pt.goods).forEach(function(e){var n=Lo(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("goods.".concat(r),"img/resources/".concat(i.tile,".png"))}),Object.keys(pt.laborers).forEach(function(e){t.load.image("laborers.".concat(e),"img/laborers/".concat(e,".png"))}),this.load.image("activeUnit","img/activeUnit.png"),Object.keys(pt.units).forEach(function(e){t.load.image("unit.".concat(e),"img/units/".concat(e,".png"))})},create:function(){var t=this;Do=this,le.graphics=_o(_o({},le.graphics),{},{territoryFills:this.add.graphics({x:0,y:0}).setDepth(2),territoryLines:this.add.graphics({x:0,y:0}).setDepth(2)}),mr.forEach(function(e){var n=pt.world[e.row][e.col];Object.assign(e,n,{tile:new Cn({hex:e}),terrain:_o(_o({},pt.terrains[n.terrain]),{},{terrain:n.terrain}),sprite:t.add.image(e.x,e.y,"tile.".concat(n.terrain)).setDepth(1).setInteractive(new Phaser.Geom.Polygon(mr.getHex({row:0,col:0}).corners),Phaser.Geom.Polygon.Contains),text:t.add.text(e.x-100,e.y+ft/3.6,e.row+"\xD7"+e.col,{fixedWidth:ft,font:"12pt Trebuchet MS",align:"center",color:"white"}).setOrigin(0)})}).forEach(function(t){"object"===Wo(t.city)&&null!==t.city&&(t.city=new sr(_o(_o({},t.city),{},{col:t.col,row:t.row,nation:le.nations[t.city.nation]}))),"string"==typeof t.improvement&&t.tile.setImprovement(t.improvement)});var e=ht();Uo.spriteOnActiveUnit=this.add.image(e.offscreen,e.offscreen,"activeUnit").setActive(!1);var n=mr.pixelWidth,r=mr.pixelHeight,i=e.width/2,o=e.height/2;this.cameras.main.setBounds(-i,-o,n+2*i,r+2*o),this.cameras.main.ignore([le.graphics.territoryFills]);var a=400,s=800;window.innerHeight<600&&(a=300,s=500);var c=this.cameras.add(e.width-s,e.height-a,s,a);c.setZoom(.2).setName("mini").setBackgroundColor(0),c.centerOn(mr.pixelWidth/2,mr.pixelHeight/2),c.ignore([le.graphics.territoryLines,Uo.spriteOnActiveUnit]),le.players[0].addUnit("rancher",mr.getHex({row:2,col:3}),this),le.players[0].addUnit("farmer",mr.getHex({row:2,col:4}),this),le.players[0].addUnit("miner",mr.getHex({row:2,col:2}),this),le.players[0].addUnit("settler",mr.getHex({row:3,col:3}),this),le.players[0].addUnit("builder",mr.getHex({row:1,col:3}),this),this.inputManager=new $i(this),this.events.on("pause",function(){le.scenes.pause("mainControls"),Ho(),le.domContainer.style.zIndex=0,t.inputManager.disableKeyboardInput()}).on("sleep",function(){le.scenes.sleep("mainControls"),le.domContainer.style.zIndex=0,t.inputManager.disableKeyboardInput()}),this.events.on("resume",function(){le.scenes.wake("mainControls"),le.currentPlayer.activateUnit(),t.inputManager.enableKeyboardInput()}).on("wake",function(){le.scenes.wake("mainControls"),le.currentPlayer.activateUnit(),t.inputManager.enableKeyboardInput()}),this.game.events.emit("scene-created-".concat(Fo)),le.startRound()},update:function(){var t=this;this.inputManager.update(),be.forEach(function(t,e){if(e.deleted)Se(e);else{if(t.x!==e.hex.x||t.y!==e.hex.y){var n=function(t,e){var n=be.get(t);if(n)return new Promise(function(r){le.events.emit("unit-moving",{unit:t}),n.scene.tweens.add({targets:n.sprite,x:e.x,y:e.y,ease:"Quad.out",duration:800,yoyo:!1,onComplete:function(t){t.destroy(),r()}})})}(e,e.hex);t.update(e.hex),n.then(function(){console.log("Sam, emitting unit-moved"),le.events.emit("unit-moved",{unit:e,promise:n})})}t.sprite.setVisible(!0),le.activeUnit===e?t.sprite.setTint(16777215).setDepth(100):t.sprite.setTint(3684408).setDepth(11)}}),jo.forEach(function(t,e){if(e.deleted)!function(t){if(jo.has(t)){var e=jo.get(t);e.sprite.setVisible(!1),e.sprite.destroy(),jo.delete(t)}}(e);else{if(t.x!==e.hex.x||t.y!==e.hex.y){var n=function(t,e){var n=jo.get(t);if(n)return new Promise(function(t){n.scene.tweens.add({targets:n.sprite,x:e.x,y:e.y,ease:"Quad.out",duration:800,yoyo:!1,onComplete:function(e){e.destroy(),t()}})})}(e,e.hex);t.update(e.hex),n.then(function(){le.events.emit("goods-moved",{goods:e,promise:n})})}t.sprite.setVisible(!0)}}),mr.forEach(function(e){var n,r;e.tile.improvement.key?function(t,e){var n,r=null===(n=t.improvement)||void 0===n?void 0:n.key;if(r&&!Io.has(t)){var i=e.add.image(t.hex.x,t.hex.y,"improvements.".concat(r)).setDepth(5);Io.set(t,i)}}(e.tile,t):(n=e.tile,(r=Io.get(n))&&(r.destroy(),Io.delete(n)))})}};function Vo(t){return Vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vo(t)}function Bo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zo(r.key),r)}}function zo(t){var e=function(t){if("object"!=Vo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Vo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vo(e)?e:e+""}function Ko(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ko=function(){return!!t})()}function Yo(t){return Yo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yo(t)}function Jo(t,e){return Jo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jo(t,e)}var Xo=[{label:"New Game",action:"newGame",enabled:function(){return!0}},{label:"Continue Game",action:"continueGame",enabled:function(){return xi()}},{label:"Achievements",action:"achievements",enabled:function(){return!0}},{label:"Help",action:"help",enabled:function(){return!0}},{label:"Settings",action:"settings",enabled:function(){return!0}},{label:"Exit",action:"exit",enabled:function(){return!0}}],$o=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){return e=Yo(e),function(t,e){if(e&&("object"==Vo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ko()?Reflect.construct(e,n||[],Yo(t).constructor):e.apply(t,n))}(this,t,[{key:"mainMenu"}])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jo(t,e)}(t,Phaser.Scene),function(t,e){return e&&Bo(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"create",value:function(){var t=this,e=this.cameras.main,n=e.width,r=e.height,i=this.add.graphics();i.fillGradientStyle(1710638,1710638,1450302,996448,1),i.fillRect(0,0,n,r),this.add.text(n/2,.15*r,"EMPIRES 4X",{fontSize:"72px",fontFamily:"Georgia, serif",color:"#e94560",stroke:"#000000",strokeThickness:6,fontStyle:"bold"}).setOrigin(.5),this.add.text(n/2,.23*r,"Build. Expand. Conquer.",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#ffffff",style:"italic"}).setOrigin(.5);var o=.35*r;this.menuButtons=Xo.map(function(e,r){var i=o+70*r;return t.createButton({x:n/2,y:i,width:300,height:50,label:e.label,enabled:e.enabled(),onClick:function(){return t.handleButtonClick(e.action)}})}),this.add.text(n-20,r-20,"v".concat("0.0.1-alpha"),{fontSize:"18px",fontFamily:"monospace",color:"#888888"}).setOrigin(1,1),this.input.keyboard.on("keydown-ESC",function(){return t.handleButtonClick("exit")});for(var a=function(){var e=Xo[s];t.input.keyboard.on("keydown-".concat(s+1),function(){e.enabled()&&t.handleButtonClick(e.action)})},s=0;s<Math.min(Xo.length,9);s++)a()}},{key:"createButton",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.label,a=t.enabled,s=t.onClick,c={graphics:null,text:null,enabled:a},u=this.add.graphics(),l=a?5452931:3355443,f=a?8072383:5592405;u.fillStyle(l,1),u.fillRoundedRect(e-r/2,n-i/2,r,i,8),u.lineStyle(2,f,1),u.strokeRoundedRect(e-r/2,n-i/2,r,i,8),c.graphics=u;var h=this.add.text(e,n,o,{fontSize:"28px",fontFamily:"Arial, sans-serif",color:a?"#ffffff":"#666666"}).setOrigin(.5);if(c.text=h,a){var y=new Phaser.Geom.Rectangle(e-r/2,n-i/2,r,i);u.setInteractive(y,Phaser.Geom.Rectangle.Contains),h.setInteractive(y,Phaser.Geom.Rectangle.Contains);var p=function(){u.clear(),u.fillStyle(8072383,1),u.fillRoundedRect(e-r/2,n-i/2,r,i,8),u.lineStyle(3,15287648,1),u.strokeRoundedRect(e-r/2,n-i/2,r,i,8),h.setScale(1.05)},v=function(){u.clear(),u.fillStyle(5452931,1),u.fillRoundedRect(e-r/2,n-i/2,r,i,8),u.lineStyle(2,8072383,1),u.strokeRoundedRect(e-r/2,n-i/2,r,i,8),h.setScale(1)},d=function(){u.clear(),u.fillStyle(10309341,1),u.fillRoundedRect(e-r/2,n-i/2,r,i,8),h.setScale(.98)},m=function(){s(),u.clear(),u.fillStyle(8072383,1),u.fillRoundedRect(e-r/2,n-i/2,r,i,8),u.lineStyle(3,15287648,1),u.strokeRoundedRect(e-r/2,n-i/2,r,i,8),h.setScale(1.05)};u.on("pointerover",p),u.on("pointerout",v),u.on("pointerdown",d),u.on("pointerup",m),h.on("pointerover",p),h.on("pointerout",v),h.on("pointerdown",d),h.on("pointerup",m)}return c}},{key:"handleButtonClick",value:function(t){switch(t){case"newGame":console.info("Starting new game..."),this.scene.start("mainGameScene");break;case"continueGame":xi()&&(console.info("Loading saved game..."),function(){try{var t=localStorage.getItem("".concat(ri,"savegame"));if(!t)return null;var e=JSON.parse(t);return 1!==e.version?(console.warn("Save game version mismatch: ".concat(e.version," vs ").concat(1)),ki()):e.state}catch(t){return console.error("Failed to load game:",t),ki()}}()?this.scene.start("mainGameScene"):this.showError("Failed to load saved game"));break;case"achievements":console.info("Opening achievements..."),this.showComingSoon("Achievements");break;case"help":console.info("Opening help..."),this.showComingSoon("Help");break;case"settings":console.info("Opening settings..."),this.scene.launch("settings",{returnScene:"mainMenu"}),this.scene.pause();break;case"exit":console.info("Exiting to homepage..."),"undefined"!=typeof yodasws&&yodasws.router?yodasws.router.go("/"):window.location.href="/";break;default:console.warn("Unknown action: ".concat(t))}}},{key:"showComingSoon",value:function(t){var e=this.cameras.main,n=e.width,r=e.height,i=this.add.graphics();i.fillStyle(0,.7),i.fillRect(0,0,n,r);var o=this.add.graphics();o.fillStyle(1710638,1),o.fillRoundedRect(n/2-200,r/2-100,400,200,10),o.lineStyle(3,15287648,1),o.strokeRoundedRect(n/2-200,r/2-100,400,200,10);var a=this.add.text(n/2,r/2-20,"".concat(t,"\nComing Soon!"),{fontSize:"32px",fontFamily:"Arial, sans-serif",color:"#ffffff",align:"center"}).setOrigin(.5),s=this.add.text(n/2,r/2+50,"Click to close",{fontSize:"18px",fontFamily:"Arial, sans-serif",color:"#888888"}).setOrigin(.5),c=function(){i.destroy(),o.destroy(),a.destroy(),s.destroy()};this.input.once("pointerdown",c),this.input.keyboard.once("keydown",c)}},{key:"showError",value:function(t){console.error(t)}}])}();function Qo(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Zo(t,e){if(t){if("string"==typeof t)return ta(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ta(t,e):void 0}}function ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ea(t){if(Array.isArray(t))return t}function na(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.htmlElementId,n=t.imageKey,r=t.scene,i=document.getElementById(e),o=r.textures.get(n);o instanceof Phaser.Textures.Texture&&i instanceof Element&&i.append(o.getSourceImage())}const ra={key:"tile-view",preload:function(){},create:function(t){var e=this,n=t.hex;if(dr(n)&&Cn.isTile(n.tile)){this.scene.pause("mainGameScene");var r=document.getElementById("tile-view");Object.keys(pt.laborers).forEach(function(t){e.load.image("laborers.".concat(t),"img/laborers/".concat(t,".png"))}),Object.entries(pt.improvements).forEach(function(t){var n=function(t,e){return ea(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||Zo(t,e)||Qo()}(t,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&e.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))}),na({imageKey:"tile.".concat(n.terrain.terrain),htmlElementId:"terrain",scene:this});var i=r.querySelector("#terrain");if(i instanceof Element){var o=document.createElement("div");o.classList.add("name"),o.innerHTML=n.terrain.name,i.appendChild(o)}if(n.tile.improvement){var a=r.querySelector("#improvements"),s=e.textures.exists("tile-view-improvement")?e.textures.get("tile-view-improvement"):e.textures.createCanvas("tile-view-improvement",ft,ft),c=s.getCanvas(),u=s.getContext(),l=W({dimensions:100,orientation:E.FLAT,origin:"topLeft"}),f=new at(l,$({width:1,height:1})).getHex({row:0,col:0});u.fillStyle="white",u.beginPath();var h=function(t){return ea(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Zo(t)||Qo()}(f.corners.map(function(t){return yt({x:t.x,y:t.y-f.y+100},{x:f.y,y:f.y},.8)})),y=h[0],p=h.slice(1);u.moveTo(y.x,y.y),p.forEach(function(t){var e=t.x,n=t.y;u.lineTo(e,n)}),u.closePath(),u.fill();var v=this.textures.get("improvements.".concat(n.tile.improvement.key)).getSourceImage(),d=(s.width-v.width)/2-2,m=(s.height-v.height)/2;s.drawFrame("improvements.".concat(n.tile.improvement.key),null,d,m),s.refresh(),a.appendChild(c);var b=document.createElement("div");b.classList.add("name"),b.innerHTML=n.tile.improvement.title,a.appendChild(b),console.log("Sam, improvement:",n.tile.improvement)}n.tile.laborers instanceof Set?(r.querySelector("#laborers"),n.tile.laborers.forEach(function(t){na({imageKey:"laborers.".concat(t.type),htmlElementId:"laborers",scene:e})})):console.log("Sam, no laborers set\u2026"),r.removeAttribute("hidden"),this.inputManager=new $i(this),this.events.on("sleep",function(){var t;r&&(r.setAttribute("hidden",!0),r.querySelectorAll("div").forEach(function(t){return t.innerHTML=""})),e.scene.wake("mainGameScene"),null===(t=e.inputManager)||void 0===t||t.disableKeyboardInput()}).on("shutdown",function(){r&&(r.setAttribute("hidden",!0),r.querySelectorAll("div").forEach(function(t){return t.innerHTML=""})),e.scene.wake("mainGameScene")})}else le.scenes.resume("mainGameScene")},update:function(){}};function ia(t){return ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ia(t)}function oa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,aa(r.key),r)}}function aa(t){var e=function(t){if("object"!=ia(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ia(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ia(e)?e:e+""}function sa(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(sa=function(){return!!t})()}function ca(t){return ca=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ca(t)}function ua(t,e){return ua=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ua(t,e)}var la=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){return e=ca(e),function(t,e){if(e&&("object"==ia(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sa()?Reflect.construct(e,n||[],ca(t).constructor):e.apply(t,n))}(this,t,[{key:"title-screen"}])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ua(t,e)}(t,Phaser.Scene),function(t,e){return e&&oa(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"preload",value:function(){this.load.image("title-background","img/title-background.png"),this.load.image("game-logo","img/game-logo.png")}},{key:"create",value:function(){var t=this,e=this.cameras.main,n=e.width,r=e.height,i=this.add.graphics();i.fillGradientStyle(661032,661032,1716042,2771562,1),i.fillRect(0,0,n,r);for(var o=0;o<r;o+=60)for(var a=0;a<n;a+=80)i.lineStyle(1,3824250,.3),i.strokeCircle(a,o,20);this.add.text(n/2,r/3,"EMPIRES 4X",{fontSize:"96px",fontFamily:"Georgia, serif",color:"#e94560",stroke:"#000000",strokeThickness:8,fontStyle:"bold"}).setOrigin(.5),this.add.text(n/2,.65*r,"Loading...",{fontSize:"32px",fontFamily:"Arial, sans-serif",color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5);var s=(n-400)/2,c=.72*r,u=this.add.graphics();u.fillStyle(2236962,.8),u.fillRect(s,c,400,30);var l=this.add.graphics(),f=function(t){l.clear(),l.fillStyle(65280,1),l.fillRect(s+2,c+2,396*t,26)},h=0,y=Date.now();f(0);var p=setInterval(function(){h=Math.min(h+.05,1),f(h),h>=1&&clearInterval(p)},100),v=setInterval(function(){var e,n;h>=1&&(clearInterval(v),e=Date.now()-y,n=Math.max(0,2e3-e),setTimeout(function(){return t.scene.start("mainMenu")},n))},50);this.input.once("pointerdown",function(){Date.now()-y>=1e3&&(clearInterval(p),clearInterval(v),h=1,f(1),t.scene.start("mainMenu"))})}}])}();const fa={TitleScreen:la,MainMenu:$o,MainGame:Go,CityView:po,MainControls:go,TechTree:{key:"techTree",preload:function(){},create:function(){},update:function(){}},TileView:ra};void 0===globalThis.document&&(globalThis.document={add:function(){return this},addEventListener:function(){return this},appendChild:function(){return this},createElement:function(){return this},getElementById:function(){return this},querySelector:function(){return this},querySelectorAll:function(){return[]},remove:function(){return this},removeAttribute:function(){return this},setAttribute:function(){return this}},globalThis.document.classList=globalThis.document,globalThis.document.style=globalThis.document);var ha=null;function ya(){le.domContainer.innerHTML="",le.domContainer.style.zIndex=0}function pa(t){ha.setAttribute("hidden",!0),ha.innerHTML=""}le.events.on("phaser-ready",function(){null!=ha||(ha=document.getElementById("tile-menu"))}),le.events.on("unit-activated",function(t){var e,n=null===(e=t.detail)||void 0===e?void 0:e.unit;if(qe.isUnit(n)&&le.activeUnit===n&&"undefined"!=typeof Element&&le.domContainer instanceof Element){le.domContainer.innerHTML="";var r=document.createElement("div");r.classList.add("unit-actions-menu");var i=le.currentPlayer,o={menu:"unit-actions-menu",hex:n.hex,unit:n,faction:i};Dr.getAvailableActions(o).forEach(function(t){var e=document.createElement("button");e.innerHTML=t.label,e.addEventListener("click",function(){t.execute(o)}),"string"==typeof t.description&&""!==t.description&&e.setAttribute("title",t.description),e.style.pointerEvents="auto",r.appendChild(e)}),le.domContainer.appendChild(r),le.domContainer.style.zIndex=1}}),le.events.on("unit-deactivated",ya),le.events.on("unit-moving",ya),le.events.on("doing-action",function(){ya(),pa()}),le.events.on("hex-clicked",function(t){var e,n,r=(null===(e=t.detail)||void 0===e?void 0:e.hex)||(null===(n=t.detail)||void 0===n||null===(n=n.unit)||void 0===n?void 0:n.hex);if(dr(r)&&Cn.isTile(r.tile)){pa();var i={menu:"tile-menu",hex:r,unit:le.activeUnit,faction:le.currentPlayer},o=Dr.getAvailableActions(i);if(0!==o.length)if(1!==o.length||"activateUnit"===o[0].key){o.forEach(function(t){var e=document.createElement("button");e.innerHTML=t.label,e.addEventListener("click",function(){t.execute(i)}),"string"==typeof t.description&&""!==t.description&&e.setAttribute("title",t.description),e.style.pointerEvents="auto",ha.appendChild(e)});var a=document.createElement("button");a.innerHTML="Cancel",a.addEventListener("click",pa),a.style.pointerEvents="auto",ha.appendChild(a),ha.style.zIndex=1,ha.removeAttribute("hidden")}else o[0].execute(i)}}),le.events.on("esc-pressed",pa),yodasws.page("pageGame").setRoute({template:"pages/game/game.html",canonicalRoute:"/game/",route:"/game/?"}).on("load",()=>{le.nations=[new hn({index:0})],le.players=[new Qe({index:0}),new Qe({index:1}),new Qe({index:2})];const t=new Phaser.Game({type:Phaser.AUTO,...ht(),zoom:.5,backgroundColor:"#71ABFF",scene:Object.values(fa),parent:document.querySelector("main"),dom:{createContainer:!0}});Promise.all([new Promise(e=>{const n=()=>{t.scene.getScene("mainGameScene")?e():setTimeout(n,50)};n()}),new Promise(e=>{const n=()=>{t.scene.getScene("mainControls")?e():setTimeout(n,50)};n()})]).then(()=>{le.events.emit("phaser-ready")}).then(()=>{t.scene.moveAbove("mainGameScene","mainControls")}),Object.assign(le,{scenes:t.scene,domContainer:t.domContainer}),t.domContainer.classList.add("game")}),window.json={},yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",()=>{})})()})();